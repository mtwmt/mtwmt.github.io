<!DOCTYPE html><html lang="en"> <head><!-- Global Metadata --><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><link rel="icon" type="image/svg+xml" href="/favicon.svg"><meta name="generator" content="Astro v5.14.1"><!-- Canonical URL --><link rel="canonical" href="https://mtwmt.com/blog/astro/astro_v5_upgrade/"><!-- Primary Meta Tags --><title>Astro 5.x 升級實戰：從 4.10 到 5.14 的完整遷移指南 | Mandy&#39;s Website</title><meta name="title" content="Astro 5.x 升級實戰：從 4.10 到 5.14 的完整遷移指南 | Mandy's Website"><meta name="description" content="前言最近進行部落格的技術升級，首先從Astro4.10.1升級到5.14.1，接著再處理[TailwindCSSv4升級](/blog/tailwindcss/tailwind_v4_upgrade/"><meta name="robots" content="index, follow"><!-- Open Graph / Facebook --><meta property="og:type" content="website"><meta property="og:url" content="https://mtwmt.com/blog/astro/astro_v5_upgrade/"><meta property="og:title" content="Astro 5.x 升級實戰：從 4.10 到 5.14 的完整遷移指南 | Mandy's Website"><meta property="og:description" content="前言最近進行部落格的技術升級，首先從Astro4.10.1升級到5.14.1，接著再處理[TailwindCSSv4升級](/blog/tailwindcss/tailwind_v4_upgrade/"><meta property="og:image" content="https://mtwmt.com/placeholder-social.jpg"><!-- Twitter --><meta property="twitter:card" content="summary_large_image"><meta property="twitter:url" content="https://mtwmt.com/blog/astro/astro_v5_upgrade/"><meta property="twitter:title" content="Astro 5.x 升級實戰：從 4.10 到 5.14 的完整遷移指南 | Mandy's Website"><meta property="twitter:description" content="前言最近進行部落格的技術升級，首先從Astro4.10.1升級到5.14.1，接著再處理[TailwindCSSv4升級](/blog/tailwindcss/tailwind_v4_upgrade/"><meta property="twitter:image" content="https://mtwmt.com/placeholder-social.jpg"><meta name="astro-view-transitions-enabled" content="true"><meta name="astro-view-transitions-fallback" content="animate"><script type="module" src="/_astro/ClientRouter.astro_astro_type_script_index_0_lang.BBA8qn6T.js"></script><!-- Google tag (gtag.js) --><script async src="https://www.googletagmanager.com/gtag/js?id=G-N8NEZBWT3S"></script><script type="module">window.dataLayer=window.dataLayer||[];function a(){dataLayer.push(arguments)}a("js",new Date);a("config","G-N8NEZBWT3S");</script><link rel="stylesheet" href="/_astro/about.BnbaqN3h.css"><script type="module" src="/_astro/page.CPvyyiTs.js"></script></head> <body class="bg-default text-default"> <div class="relative mx-auto 
      before:fixed before:right-0 before:top-0 before:block before:w-80 
      lg:before:h-screen before:bg-primary-900 before:transition 
      lg:max-w-7xl lg:before:w-1/2">  <input id="nav-toggle" type="checkbox" class="hidden nav-toggle"> <header class="bg-primary-900 lg:flex lg:h-[180px] lg:flex-row-reverse lg:justify-between"> <div class="translate-x-0 animation relative w-full font-dosis lg:flex lg:h-full lg:w-80 lg:items-center lg:justify-center lg:bg-primary-500 lg:transition-none"> <h2 class="w-40 bg-primary-500 text-center text-2xl leading-loose text-white lg:w-auto lg:text-4xl"> <a href="/">Mandy's Web</a> </h2> <label id="hamburger" for="nav-toggle" title="MENU" class="absolute right-5 top-1/2 h-7 w-8 -translate-y-1/2 cursor-pointer lg:hidden"> <span class="animation absolute top-1/2 h-[2px] w-full -translate-y-1/2 bg-white before:absolute before:-top-2.5 before:h-[2px] before:w-full before:bg-white after:absolute after:top-2.5 after:h-[2px] after:w-full after:bg-white lg:transition-none"></span></label> </div> <div class="translate-x-0 animation relative z-10 bg-light py-4 text-center lg:flex lg:w-[calc(100%-20rem)] lg:flex-row-reverse lg:items-center lg:justify-between lg:px-[4vw] lg:transition-none"> <p class="mb-4 lg:mb-0">因為會忘，所以要寫下來</p> <nav> <ul class="flex justify-center font-dosis uppercase lg:justify-start"> <li class="mx-4 text-center "> <a href="/about"> <span class="flex justify-center items-center mb-2 h-12 w-12 rounded-[50%] border border-neutral-300 text-center leading-[46px]"> <svg width="1em" height="1em" viewBox="0 0 24 24" class="h-6 w-6 " data-icon="ic:outline-question-mark">  <symbol id="ai:ic:outline-question-mark"><path fill="currentColor" d="M11.07 12.85c.77-1.39 2.25-2.21 3.11-3.44c.91-1.29.4-3.7-2.18-3.7c-1.69 0-2.52 1.28-2.87 2.34L6.54 6.96C7.25 4.83 9.18 3 11.99 3c2.35 0 3.96 1.07 4.78 2.41c.7 1.15 1.11 3.3.03 4.9c-1.2 1.77-2.35 2.31-2.97 3.45c-.25.46-.35.76-.35 2.24h-2.89c-.01-.78-.13-2.05.48-3.15M14 20c0 1.1-.9 2-2 2s-2-.9-2-2s.9-2 2-2s2 .9 2 2"/></symbol><use  xlink:href="#ai:ic:outline-question-mark"></use>  </svg> </span> about </a> </li><li class="mx-4 text-center "> <a href="/blog/page/1"> <span class="flex justify-center items-center mb-2 h-12 w-12 rounded-[50%] border border-neutral-300 text-center leading-[46px]"> <svg width="1em" height="1em" viewBox="0 0 24 24" class="h-6 w-6 " data-icon="ic:outline-format-bold">  <symbol id="ai:ic:outline-format-bold"><path fill="currentColor" d="M15.6 10.79c.97-.67 1.65-1.77 1.65-2.79c0-2.26-1.75-4-4-4H7v14h7.04c2.09 0 3.71-1.7 3.71-3.79c0-1.52-.86-2.82-2.15-3.42M10 6.5h3c.83 0 1.5.67 1.5 1.5s-.67 1.5-1.5 1.5h-3zm3.5 9H10v-3h3.5c.83 0 1.5.67 1.5 1.5s-.67 1.5-1.5 1.5"/></symbol><use  xlink:href="#ai:ic:outline-format-bold"></use>  </svg> </span> blog </a> </li><li class="mx-4 text-center "> <a href="/contact"> <span class="flex justify-center items-center mb-2 h-12 w-12 rounded-[50%] border border-neutral-300 text-center leading-[46px]"> <svg width="1em" height="1em" viewBox="0 0 24 24" class="h-6 w-6 " data-icon="ic:outline-mode-comment">  <symbol id="ai:ic:outline-mode-comment"><path fill="currentColor" d="M20 17.17L18.83 16H4V4h16zM20 2H4c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h14l4 4V4c0-1.1-.9-2-2-2"/></symbol><use  xlink:href="#ai:ic:outline-mode-comment"></use>  </svg> </span> submit </a> </li> <li class="mx-4 text-center"> <div class="inline-flex undefined"> <input class="absolute opacity-0" id="theme-switcher" data-theme-switcher type="checkbox"> <label class="relative" for="theme-switcher"> <span class="cursor-pointer flex justify-center items-center mb-2 h-12 w-12 rounded-[50%] border border-neutral-300 text-center leading-[46px]"> <svg width="1em" height="1em" viewBox="0 0 24 24" class="h-6 w-6 hidden dark:block" data-icon="ic:outline-dark-mode">  <symbol id="ai:ic:outline-dark-mode"><path fill="currentColor" d="M9.37 5.51A7.4 7.4 0 0 0 9.1 7.5c0 4.08 3.32 7.4 7.4 7.4c.68 0 1.35-.09 1.99-.27A7.01 7.01 0 0 1 12 19c-3.86 0-7-3.14-7-7c0-2.93 1.81-5.45 4.37-6.49M12 3a9 9 0 1 0 9 9c0-.46-.04-.92-.1-1.36a5.39 5.39 0 0 1-4.4 2.26a5.403 5.403 0 0 1-3.14-9.8c-.44-.06-.9-.1-1.36-.1"/></symbol><use  xlink:href="#ai:ic:outline-dark-mode"></use>  </svg> <svg width="1em" height="1em" viewBox="0 0 24 24" class="h-6 w-6 block dark:hidden" data-icon="ic:outline-light-mode">  <symbol id="ai:ic:outline-light-mode"><path fill="currentColor" d="M12 9c1.65 0 3 1.35 3 3s-1.35 3-3 3s-3-1.35-3-3s1.35-3 3-3m0-2c-2.76 0-5 2.24-5 5s2.24 5 5 5s5-2.24 5-5s-2.24-5-5-5M2 13h2c.55 0 1-.45 1-1s-.45-1-1-1H2c-.55 0-1 .45-1 1s.45 1 1 1m18 0h2c.55 0 1-.45 1-1s-.45-1-1-1h-2c-.55 0-1 .45-1 1s.45 1 1 1M11 2v2c0 .55.45 1 1 1s1-.45 1-1V2c0-.55-.45-1-1-1s-1 .45-1 1m0 18v2c0 .55.45 1 1 1s1-.45 1-1v-2c0-.55-.45-1-1-1s-1 .45-1 1M5.99 4.58a.996.996 0 0 0-1.41 0a.996.996 0 0 0 0 1.41l1.06 1.06c.39.39 1.03.39 1.41 0s.39-1.03 0-1.41zm12.37 12.37a.996.996 0 0 0-1.41 0a.996.996 0 0 0 0 1.41l1.06 1.06c.39.39 1.03.39 1.41 0a.996.996 0 0 0 0-1.41zm1.06-10.96a.996.996 0 0 0 0-1.41a.996.996 0 0 0-1.41 0l-1.06 1.06c-.39.39-.39 1.03 0 1.41s1.03.39 1.41 0zM7.05 18.36a.996.996 0 0 0 0-1.41a.996.996 0 0 0-1.41 0l-1.06 1.06c-.39.39-.39 1.03 0 1.41s1.03.39 1.41 0z"/></symbol><use  xlink:href="#ai:ic:outline-light-mode"></use>  </svg> </span>
mode
</label> </div> <script type="module">const a=()=>{const e=(()=>typeof localStorage<"u"&&localStorage.getItem("theme")?localStorage.getItem("theme")==="dark":!!window.matchMedia("(prefers-color-scheme: dark)").matches),c=document.querySelectorAll("[data-theme-switcher]");e()&&document.documentElement.classList.add("dark"),[].forEach.call(c,function(t){t.checked=!!e(),t.addEventListener("click",()=>{document.documentElement.classList.toggle("dark"),localStorage.setItem("theme",document.documentElement.classList.contains("dark")?"dark":"light")})})};document.addEventListener("astro:after-swap",a);a();</script> </li> </ul> </nav> </div> </header>  <main class="relative z-[1] block min-h-full overflow-hidden
  before:fixed before:top-0 before:left-1/2 before:ml-[640px] before:block before:h-full before:min-h-screen before:w-[1px] 
  before:bg-primary-500 after:fixed after:top-0 after:right-1/2 
  after:mr-[640px] after:block after:h-full after:min-h-screen after:w-[1px] after:bg-border lg:flex"> <article class=" min-h-[calc(100vh-180px)]  animation relative z-[1] bg-default lg:float-left lg:w-[calc(100%-20rem)] lg:transition-none">   <div class="py-[3.35rem] px-[4vw]"> <time>Oct 4, 2025</time><!-- <div class=` ${className}`>
	<span class="text-6xl font-bold block">{
		new Date(date).getDate().toString().padStart(2, '0')
	}</span>
	<span>{
		`${date.toLocaleDateString('en-us', {
			month: 'short',
		})} ${new Date(date).getFullYear()}`
	}</span>
</div>  --> <h1 class="text-3xl leading-loose text-default">Astro 5.x 升級實戰：從 4.10 到 5.14 的完整遷移指南</h1> <p class>6 minutes to read</p> <div class="mt-2"> <a href="/blog/tags/astro" class="px-2 py-1 mr-2 text-xs font-normal border rounded-md border-primary-100 text-primary-500 bg-primary-50
        dark:border-primary-400 dark:bg-primary-500 dark:text-primary-50
        ">astro</a><a href="/blog/tags/javascript" class="px-2 py-1 mr-2 text-xs font-normal border rounded-md border-primary-100 text-primary-500 bg-primary-50
        dark:border-primary-400 dark:bg-primary-500 dark:text-primary-50
        ">javascript</a><a href="/blog/tags/typescript" class="px-2 py-1 mr-2 text-xs font-normal border rounded-md border-primary-100 text-primary-500 bg-primary-50
        dark:border-primary-400 dark:bg-primary-500 dark:text-primary-50
        ">typescript</a> </div> </div> <div class="border-y border-default py-10 px-[4vw]"> <div class="post"> <h2 id="前言">前言</h2>
<p>最近進行部落格的技術升級，首先從 Astro 4.10.1 升級到 5.14.1，接著再處理 <a href="/blog/tailwindcss/tailwind_v4_upgrade/">TailwindCSS v4 升級</a>。Astro 的升級相對平順，主要是 API 變更和最佳實踐的調整，沒有 TailwindCSS 那麼多坑要踩。</p>
<h2 id="升級概述">升級概述</h2>
<p><strong>升級版本：</strong></p>
<ul>
<li>Astro: 4.10.1 → 5.14.1</li>
<li>@astrojs/mdx: 3.1.4 → 4.3.6</li>
<li>@astrojs/rss: 4.0.7 → 4.0.12</li>
<li>@astrojs/sitemap: 3.1.6 → 3.6.0</li>
</ul>
<p><strong>主要變更：</strong></p>
<ul>
<li>ViewTransitions → ClientRouter</li>
<li>Content Collections API 更新</li>
<li>實驗性功能清理</li>
<li>整合套件版本同步</li>
</ul>
<h2 id="第一階段升級核心套件">第一階段：升級核心套件</h2>
<h3 id="1-更新-astro-及相關套件">1. 更新 Astro 及相關套件</h3>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="bash"><code><span class="line"><span style="color:#B392F0">npm</span><span style="color:#9ECBFF"> install</span><span style="color:#9ECBFF"> astro@latest</span><span style="color:#9ECBFF"> @astrojs/mdx@latest</span><span style="color:#9ECBFF"> @astrojs/rss@latest</span><span style="color:#9ECBFF"> @astrojs/sitemap@latest</span></span></code></pre>
<h3 id="2-檢查重大變更">2. 檢查重大變更</h3>
<p>Astro 5.x 移除了許多實驗性功能，需要檢查 <code>astro.config.mjs</code>：</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="javascript"><code><span class="line"><span style="color:#6A737D">// ❌ Astro 4.x (已棄用)</span></span>
<span class="line"><span style="color:#F97583">export</span><span style="color:#F97583"> default</span><span style="color:#B392F0"> defineConfig</span><span style="color:#E1E4E8">({</span></span>
<span class="line"><span style="color:#E1E4E8">  experimental: {</span></span>
<span class="line"><span style="color:#E1E4E8">    contentCollectionCache: </span><span style="color:#79B8FF">true</span><span style="color:#E1E4E8">,  </span><span style="color:#6A737D">// 已移除</span></span>
<span class="line"><span style="color:#E1E4E8">  },</span></span>
<span class="line"><span style="color:#E1E4E8">});</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D">// ✅ Astro 5.x</span></span>
<span class="line"><span style="color:#F97583">export</span><span style="color:#F97583"> default</span><span style="color:#B392F0"> defineConfig</span><span style="color:#E1E4E8">({</span></span>
<span class="line"><span style="color:#6A737D">  // 不再需要 experimental 設定</span></span>
<span class="line"><span style="color:#E1E4E8">  prefetch: </span><span style="color:#79B8FF">true</span><span style="color:#E1E4E8">,  </span><span style="color:#6A737D">// 現在是正式功能</span></span>
<span class="line"><span style="color:#E1E4E8">});</span></span></code></pre>
<h2 id="第二階段viewtransitions--clientrouter">第二階段：ViewTransitions → ClientRouter</h2>
<h3 id="問題viewtransitions-已棄用">問題：ViewTransitions 已棄用</h3>
<p>Astro 5.x 將 <code>ViewTransitions</code> 改名為 <code>ClientRouter</code>，這是一個重要的 API 變更。</p>
<p><strong>錯誤訊息：</strong></p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>The &#x3C;ViewTransitions /> component has been renamed to &#x3C;ClientRouter />.</span></span></code></pre>
<h3 id="解決方案更新所有引用">解決方案：更新所有引用</h3>
<p><strong>BaseHead.astro 修改：</strong></p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="astro"><code><span class="line"><span style="color:#6A737D">---</span></span>
<span class="line"><span style="color:#6A737D">// ❌ Astro 4.x</span></span>
<span class="line"><span style="color:#F97583">import</span><span style="color:#E1E4E8"> { ViewTransitions } </span><span style="color:#F97583">from</span><span style="color:#9ECBFF"> 'astro:transitions'</span><span style="color:#E1E4E8">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D">// ✅ Astro 5.x</span></span>
<span class="line"><span style="color:#F97583">import</span><span style="color:#E1E4E8"> { ClientRouter } </span><span style="color:#F97583">from</span><span style="color:#9ECBFF"> 'astro:transitions'</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#6A737D">---</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D">&#x3C;!-- ❌ 舊寫法 --></span></span>
<span class="line"><span style="color:#E1E4E8">&#x3C;</span><span style="color:#79B8FF">ViewTransitions</span><span style="color:#E1E4E8"> /></span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D">&#x3C;!-- ✅ 新寫法 --></span></span>
<span class="line"><span style="color:#E1E4E8">&#x3C;</span><span style="color:#79B8FF">ClientRouter</span><span style="color:#E1E4E8"> /></span></span></code></pre>
<p><strong>為什麼改名？</strong></p>
<p><code>ClientRouter</code> 更清楚地表達了它的功能：</p>
<ul>
<li>這是一個<strong>客戶端路由器</strong>，而非單純的過場動畫</li>
<li>負責 SPA 式的頁面切換</li>
<li>處理預載入（prefetch）邏輯</li>
</ul>
<h2 id="第三階段content-collections-優化">第三階段：Content Collections 優化</h2>
<h3 id="1-型別定義改進">1. 型別定義改進</h3>
<p>Astro 5.x 的 Content Collections 型別推斷更強大：</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="typescript"><code><span class="line"><span style="color:#6A737D">// ✅ 使用 CollectionEntry 型別</span></span>
<span class="line"><span style="color:#F97583">import</span><span style="color:#F97583"> type</span><span style="color:#E1E4E8"> { CollectionEntry } </span><span style="color:#F97583">from</span><span style="color:#9ECBFF"> 'astro:content'</span><span style="color:#E1E4E8">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">export</span><span style="color:#F97583"> const</span><span style="color:#B392F0"> findPrevAndNext</span><span style="color:#F97583"> =</span><span style="color:#E1E4E8"> (</span></span>
<span class="line"><span style="color:#FFAB70">  arr</span><span style="color:#F97583">:</span><span style="color:#B392F0"> CollectionEntry</span><span style="color:#E1E4E8">&#x3C;</span><span style="color:#9ECBFF">'blog'</span><span style="color:#E1E4E8">>[],</span></span>
<span class="line"><span style="color:#FFAB70">  curr</span><span style="color:#F97583">:</span><span style="color:#B392F0"> CollectionEntry</span><span style="color:#E1E4E8">&#x3C;</span><span style="color:#9ECBFF">'blog'</span><span style="color:#E1E4E8">></span></span>
<span class="line"><span style="color:#E1E4E8">) </span><span style="color:#F97583">=></span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#6A737D">  // TypeScript 現在能完整推斷 slug, data 等屬性</span></span>
<span class="line"><span style="color:#F97583">  const</span><span style="color:#79B8FF"> currentIndex</span><span style="color:#F97583"> =</span><span style="color:#E1E4E8"> arr.</span><span style="color:#B392F0">findIndex</span><span style="color:#E1E4E8">((</span><span style="color:#FFAB70">obj</span><span style="color:#E1E4E8">) </span><span style="color:#F97583">=></span><span style="color:#E1E4E8"> obj.slug </span><span style="color:#F97583">===</span><span style="color:#E1E4E8"> curr.slug);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D">  // ...</span></span>
<span class="line"><span style="color:#E1E4E8">};</span></span></code></pre>
<p><strong>改進點：</strong></p>
<ul>
<li>✅ 不再需要手動定義 post 型別</li>
<li>✅ <code>slug</code>、<code>data</code>、<code>render()</code> 等方法都有完整型別提示</li>
<li>✅ 支援泛型，可以指定 collection 名稱</li>
</ul>
<h3 id="2-getcollection-使用最佳實踐">2. getCollection 使用最佳實踐</h3>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="astro"><code><span class="line"><span style="color:#6A737D">---</span></span>
<span class="line"><span style="color:#F97583">import</span><span style="color:#E1E4E8"> { getCollection } </span><span style="color:#F97583">from</span><span style="color:#9ECBFF"> 'astro:content'</span><span style="color:#E1E4E8">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D">// ✅ 在 getStaticPaths 中使用</span></span>
<span class="line"><span style="color:#F97583">export</span><span style="color:#F97583"> async</span><span style="color:#F97583"> function</span><span style="color:#B392F0"> getStaticPaths</span><span style="color:#E1E4E8">() {</span></span>
<span class="line"><span style="color:#F97583">  const</span><span style="color:#79B8FF"> posts</span><span style="color:#F97583"> =</span><span style="color:#F97583"> await</span><span style="color:#B392F0"> getCollection</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">"blog"</span><span style="color:#E1E4E8">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">  return</span><span style="color:#E1E4E8"> posts.</span><span style="color:#B392F0">map</span><span style="color:#E1E4E8">((</span><span style="color:#FFAB70">post</span><span style="color:#E1E4E8">) </span><span style="color:#F97583">=></span><span style="color:#E1E4E8"> ({</span></span>
<span class="line"><span style="color:#E1E4E8">    params: { slug: post.slug },</span></span>
<span class="line"><span style="color:#E1E4E8">    props: { post },</span></span>
<span class="line"><span style="color:#E1E4E8">  }));</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D">// ✅ 在 Astro 組件中使用</span></span>
<span class="line"><span style="color:#F97583">const</span><span style="color:#79B8FF"> posts</span><span style="color:#F97583"> =</span><span style="color:#F97583"> await</span><span style="color:#B392F0"> getCollection</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">"blog"</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#F97583">const</span><span style="color:#E1E4E8"> { </span><span style="color:#79B8FF">post</span><span style="color:#E1E4E8"> } </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> Astro.props;</span></span>
<span class="line"><span style="color:#F97583">const</span><span style="color:#E1E4E8"> { </span><span style="color:#79B8FF">Content</span><span style="color:#E1E4E8"> } </span><span style="color:#F97583">=</span><span style="color:#F97583"> await</span><span style="color:#E1E4E8"> post.</span><span style="color:#B392F0">render</span><span style="color:#E1E4E8">();</span></span>
<span class="line"><span style="color:#6A737D">---</span></span></code></pre>
<h2 id="第四階段清理未使用的程式碼">第四階段：清理未使用的程式碼</h2>
<h3 id="1-移除實驗性配置">1. 移除實驗性配置</h3>
<p>Astro 5.x 移除了許多實驗性功能，檢查 <code>astro.config.mjs</code>：</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="javascript"><code><span class="line"><span style="color:#6A737D">// ❌ 移除這些已棄用的設定</span></span>
<span class="line"><span style="color:#F97583">export</span><span style="color:#F97583"> default</span><span style="color:#B392F0"> defineConfig</span><span style="color:#E1E4E8">({</span></span>
<span class="line"><span style="color:#E1E4E8">  experimental: {</span></span>
<span class="line"><span style="color:#E1E4E8">    contentCollectionCache: </span><span style="color:#79B8FF">true</span><span style="color:#E1E4E8">,    </span><span style="color:#6A737D">// 已移除</span></span>
<span class="line"><span style="color:#E1E4E8">    contentCollectionJsonSchema: </span><span style="color:#79B8FF">true</span><span style="color:#E1E4E8">, </span><span style="color:#6A737D">// 已移除</span></span>
<span class="line"><span style="color:#E1E4E8">  },</span></span>
<span class="line"><span style="color:#E1E4E8">});</span></span></code></pre>
<h3 id="2-清理註解掉的程式碼">2. 清理註解掉的程式碼</h3>
<p>升級過程中累積的註解程式碼應該清理：</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="javascript"><code><span class="line"><span style="color:#6A737D">// ❌ 刪除不用的註解</span></span>
<span class="line"><span style="color:#6A737D">// markdown: {</span></span>
<span class="line"><span style="color:#6A737D">//   shikiConfig: {</span></span>
<span class="line"><span style="color:#6A737D">//     theme: "material-theme-darker",</span></span>
<span class="line"><span style="color:#6A737D">//     wrap: true,</span></span>
<span class="line"><span style="color:#6A737D">//   },</span></span>
<span class="line"><span style="color:#6A737D">// },</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D">// ✅ 保持配置檔簡潔</span></span>
<span class="line"><span style="color:#F97583">export</span><span style="color:#F97583"> default</span><span style="color:#B392F0"> defineConfig</span><span style="color:#E1E4E8">({</span></span>
<span class="line"><span style="color:#E1E4E8">  site: </span><span style="color:#9ECBFF">"https://mtwmt.com"</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#E1E4E8">  prefetch: </span><span style="color:#79B8FF">true</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#E1E4E8">  integrations: [</span><span style="color:#6A737D">/* ... */</span><span style="color:#E1E4E8">],</span></span>
<span class="line"><span style="color:#E1E4E8">});</span></span></code></pre>
<h2 id="第五階段typescript-最佳實踐">第五階段：TypeScript 最佳實踐</h2>
<h3 id="1-移除-any-型別">1. 移除 <code>any</code> 型別</h3>
<p>Astro 5.x 的型別系統更完善，不再需要 <code>any</code>：</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="typescript"><code><span class="line"><span style="color:#6A737D">// ❌ Astro 4.x 常見寫法</span></span>
<span class="line"><span style="color:#E1E4E8">menu.</span><span style="color:#B392F0">map</span><span style="color:#E1E4E8">((</span><span style="color:#FFAB70">d</span><span style="color:#F97583">:</span><span style="color:#79B8FF"> any</span><span style="color:#E1E4E8">) </span><span style="color:#F97583">=></span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#F97583">  return</span><span style="color:#E1E4E8"> (</span></span>
<span class="line"><span style="color:#E1E4E8">    &#x3C;</span><span style="color:#B392F0">li</span><span style="color:#E1E4E8">></span></span>
<span class="line"><span style="color:#F97583">      &#x3C;</span><span style="color:#E1E4E8">a href</span><span style="color:#F97583">=</span><span style="color:#E1E4E8">{d.href}</span><span style="color:#F97583">></span><span style="color:#E1E4E8">{d.name}</span><span style="color:#F97583">&#x3C;/</span><span style="color:#E1E4E8">a</span><span style="color:#F97583">></span></span>
<span class="line"><span style="color:#F97583">    &#x3C;/</span><span style="color:#E1E4E8">li</span><span style="color:#F97583">></span></span>
<span class="line"><span style="color:#E1E4E8">  );</span></span>
<span class="line"><span style="color:#E1E4E8">})</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D">// ✅ Astro 5.x 推薦寫法</span></span>
<span class="line"><span style="color:#E1E4E8">menu.</span><span style="color:#B392F0">map</span><span style="color:#E1E4E8">((</span><span style="color:#FFAB70">d</span><span style="color:#E1E4E8">) </span><span style="color:#F97583">=></span><span style="color:#E1E4E8"> (</span></span>
<span class="line"><span style="color:#E1E4E8">  &#x3C;</span><span style="color:#B392F0">li</span><span style="color:#E1E4E8">></span></span>
<span class="line"><span style="color:#F97583">    &#x3C;</span><span style="color:#E1E4E8">a href</span><span style="color:#F97583">=</span><span style="color:#E1E4E8">{d.href}</span><span style="color:#F97583">></span><span style="color:#E1E4E8">{d.name}</span><span style="color:#F97583">&#x3C;/</span><span style="color:#E1E4E8">a</span><span style="color:#F97583">></span></span>
<span class="line"><span style="color:#F97583">  &#x3C;/</span><span style="color:#E1E4E8">li</span><span style="color:#F97583">></span></span>
<span class="line"><span style="color:#E1E4E8">))</span></span></code></pre>
<h3 id="2-客戶端腳本型別安全">2. 客戶端腳本型別安全</h3>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="typescript"><code><span class="line"><span style="color:#6A737D">// ❌ 舊寫法</span></span>
<span class="line"><span style="color:#F97583">let</span><span style="color:#E1E4E8"> codeBlocks </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> Array.</span><span style="color:#B392F0">from</span><span style="color:#E1E4E8">(document.</span><span style="color:#B392F0">querySelectorAll</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">"pre"</span><span style="color:#E1E4E8">)) </span><span style="color:#F97583">as</span><span style="color:#79B8FF"> any</span><span style="color:#E1E4E8">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">async</span><span style="color:#F97583"> function</span><span style="color:#B392F0"> copyCode</span><span style="color:#E1E4E8">(</span><span style="color:#FFAB70">block</span><span style="color:#F97583">:</span><span style="color:#79B8FF"> any</span><span style="color:#E1E4E8">, </span><span style="color:#FFAB70">button</span><span style="color:#F97583">:</span><span style="color:#79B8FF"> any</span><span style="color:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#F97583">  let</span><span style="color:#E1E4E8"> code </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> block.</span><span style="color:#B392F0">querySelector</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">"code"</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#6A737D">  // ...</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D">// ✅ 新寫法</span></span>
<span class="line"><span style="color:#F97583">let</span><span style="color:#E1E4E8"> codeBlocks </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> Array.</span><span style="color:#B392F0">from</span><span style="color:#E1E4E8">(document.</span><span style="color:#B392F0">querySelectorAll</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">"pre"</span><span style="color:#E1E4E8">));</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">async</span><span style="color:#F97583"> function</span><span style="color:#B392F0"> copyCode</span><span style="color:#E1E4E8">(</span><span style="color:#FFAB70">block</span><span style="color:#F97583">:</span><span style="color:#B392F0"> HTMLPreElement</span><span style="color:#E1E4E8">, </span><span style="color:#FFAB70">button</span><span style="color:#F97583">:</span><span style="color:#B392F0"> HTMLButtonElement</span><span style="color:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#F97583">  let</span><span style="color:#E1E4E8"> code </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> block.</span><span style="color:#B392F0">querySelector</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">"code"</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#F97583">  let</span><span style="color:#E1E4E8"> text </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> code?.innerText </span><span style="color:#F97583">||</span><span style="color:#9ECBFF"> ""</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#6A737D">  // ...</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span></code></pre>
<h3 id="3-安全的-dom-操作">3. 安全的 DOM 操作</h3>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="typescript"><code><span class="line"><span style="color:#6A737D">// ❌ 可能導致錯誤</span></span>
<span class="line"><span style="color:#E1E4E8">codeBlock.parentNode.</span><span style="color:#B392F0">insertBefore</span><span style="color:#E1E4E8">(wrapper, codeBlock);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D">// ✅ 使用可選鏈</span></span>
<span class="line"><span style="color:#E1E4E8">codeBlock.parentNode?.</span><span style="color:#B392F0">insertBefore</span><span style="color:#E1E4E8">(wrapper, codeBlock);</span></span></code></pre>
<h2 id="第六階段效能優化">第六階段：效能優化</h2>
<h3 id="1-prefetch-設定">1. Prefetch 設定</h3>
<p>Astro 5.x 將 prefetch 變為正式功能：</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="javascript"><code><span class="line"><span style="color:#F97583">export</span><span style="color:#F97583"> default</span><span style="color:#B392F0"> defineConfig</span><span style="color:#E1E4E8">({</span></span>
<span class="line"><span style="color:#E1E4E8">  prefetch: </span><span style="color:#79B8FF">true</span><span style="color:#E1E4E8">,  </span><span style="color:#6A737D">// 啟用自動預載入</span></span>
<span class="line"><span style="color:#E1E4E8">});</span></span></code></pre>
<p><strong>效果：</strong></p>
<ul>
<li>自動預載入可見連結</li>
<li>減少頁面切換延遲</li>
<li>改善使用者體驗</li>
</ul>
<h3 id="2-移除未使用的依賴">2. 移除未使用的依賴</h3>
<p>升級後檢查並移除未使用的套件：</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="bash"><code><span class="line"><span style="color:#6A737D"># 檢查已安裝但未使用的套件</span></span>
<span class="line"><span style="color:#B392F0">npm</span><span style="color:#9ECBFF"> uninstall</span><span style="color:#9ECBFF"> astro-expressive-code</span><span style="color:#9ECBFF"> @tailwindcss/forms</span></span></code></pre>
<p><strong>移除後的好處：</strong></p>
<ul>
<li>✅ 減少 <code>node_modules</code> 大小</li>
<li>✅ 加快安裝速度</li>
<li>✅ 降低安全風險</li>
</ul>
<h3 id="3-icon-載入優化">3. Icon 載入優化</h3>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="javascript"><code><span class="line"><span style="color:#6A737D">// ❌ 載入所有 icons（效能差）</span></span>
<span class="line"><span style="color:#B392F0">icon</span><span style="color:#E1E4E8">({</span></span>
<span class="line"><span style="color:#E1E4E8">  include: {</span></span>
<span class="line"><span style="color:#9ECBFF">    "grommet-icons"</span><span style="color:#E1E4E8">: [</span><span style="color:#9ECBFF">"*"</span><span style="color:#E1E4E8">],</span></span>
<span class="line"><span style="color:#E1E4E8">    teenyicons: [</span><span style="color:#9ECBFF">"*"</span><span style="color:#E1E4E8">],</span></span>
<span class="line"><span style="color:#6A737D">    // ...</span></span>
<span class="line"><span style="color:#E1E4E8">  },</span></span>
<span class="line"><span style="color:#E1E4E8">})</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D">// ✅ 只載入使用的 icons（建議）</span></span>
<span class="line"><span style="color:#B392F0">icon</span><span style="color:#E1E4E8">({</span></span>
<span class="line"><span style="color:#E1E4E8">  include: {</span></span>
<span class="line"><span style="color:#9ECBFF">    "grommet-icons"</span><span style="color:#E1E4E8">: [</span><span style="color:#9ECBFF">"info"</span><span style="color:#E1E4E8">],</span></span>
<span class="line"><span style="color:#E1E4E8">    teenyicons: [</span><span style="color:#9ECBFF">"left-outline"</span><span style="color:#E1E4E8">, </span><span style="color:#9ECBFF">"right-outline"</span><span style="color:#E1E4E8">],</span></span>
<span class="line"><span style="color:#E1E4E8">    ic: [</span><span style="color:#9ECBFF">"outline-search"</span><span style="color:#E1E4E8">, </span><span style="color:#9ECBFF">"outline-question-mark"</span><span style="color:#E1E4E8">],</span></span>
<span class="line"><span style="color:#6A737D">    // 只列出實際使用的</span></span>
<span class="line"><span style="color:#E1E4E8">  },</span></span>
<span class="line"><span style="color:#E1E4E8">})</span></span></code></pre>
<h2 id="關鍵知識點總結">關鍵知識點總結</h2>
<h3 id="1-api-名稱變更">1. API 名稱變更</h3>




















<table><thead><tr><th>Astro 4.x</th><th>Astro 5.x</th><th>說明</th></tr></thead><tbody><tr><td><code>ViewTransitions</code></td><td><code>ClientRouter</code></td><td>更清楚表達客戶端路由功能</td></tr><tr><td><code>experimental.contentCollectionCache</code></td><td>已移除</td><td>現在是預設行為</td></tr></tbody></table>
<h3 id="2-typescript-改進">2. TypeScript 改進</h3>
<ul>
<li>✅ <code>CollectionEntry&#x3C;T></code> 型別更精確</li>
<li>✅ 不再需要手動定義 post 型別</li>
<li>✅ 更好的型別推斷和自動完成</li>
</ul>
<h3 id="3-效能優化重點">3. 效能優化重點</h3>
<ul>
<li>✅ <code>prefetch: true</code> 啟用自動預載入</li>
<li>✅ Icon 按需載入，避免全量引入</li>
<li>✅ 移除未使用的依賴</li>
</ul>
<h2 id="驗證升級成功">驗證升級成功</h2>
<h3 id="1-建置測試">1. 建置測試</h3>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="bash"><code><span class="line"><span style="color:#B392F0">npm</span><span style="color:#9ECBFF"> run</span><span style="color:#9ECBFF"> build</span></span></code></pre>
<p>應該看到：</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>[build] 263 page(s) built in 9.52s</span></span>
<span class="line"><span>[build] Complete!</span></span></code></pre>
<h3 id="2-開發伺服器測試">2. 開發伺服器測試</h3>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="bash"><code><span class="line"><span style="color:#B392F0">npm</span><span style="color:#9ECBFF"> run</span><span style="color:#9ECBFF"> dev</span></span></code></pre>
<p>檢查：</p>
<ul>
<li>✅ ClientRouter 正常運作</li>
<li>✅ 頁面切換流暢</li>
<li>✅ Prefetch 功能啟用</li>
<li>✅ 無 TypeScript 錯誤</li>
</ul>
<h3 id="3-功能測試">3. 功能測試</h3>
<ul>
<li>✅ Content Collections 正常讀取</li>
<li>✅ MDX 渲染正確</li>
<li>✅ RSS feed 生成成功</li>
<li>✅ Sitemap 生成正確</li>
</ul>
<h2 id="常見問題-faq">常見問題 FAQ</h2>
<h3 id="q1-viewtransitions-和-clientrouter-有什麼差別">Q1: ViewTransitions 和 ClientRouter 有什麼差別？</h3>
<p><strong>A:</strong> 功能完全相同，只是改名。<code>ClientRouter</code> 更清楚表達它是一個客戶端路由器，負責 SPA 式的頁面切換。</p>
<h3 id="q2-升級後-content-collections-報錯怎麼辦">Q2: 升級後 Content Collections 報錯怎麼辦？</h3>
<p><strong>A:</strong> 檢查以下幾點：</p>
<ol>
<li>使用 <code>CollectionEntry&#x3C;'blog'></code> 型別</li>
<li>確認 <code>src/content/config.ts</code> 的 schema 定義正確</li>
<li>檢查是否有使用已棄用的 API</li>
</ol>
<h3 id="q3-需要更新所有-astrojs-套件嗎">Q3: 需要更新所有 @astrojs/* 套件嗎？</h3>
<p><strong>A:</strong> 是的。Astro 5.x 的整合套件（@astrojs/mdx、@astrojs/rss 等）都需要更新到對應版本，否則可能不相容。</p>
<h3 id="q4-prefetch-會影響效能嗎">Q4: prefetch 會影響效能嗎？</h3>
<p><strong>A:</strong> 不會。Astro 的 prefetch 很聰明：</p>
<ul>
<li>只預載入可見連結</li>
<li>使用 Intersection Observer</li>
<li>不會重複載入</li>
<li>可以針對個別連結停用</li>
</ul>
<h3 id="q5-如何確認所有功能都正常">Q5: 如何確認所有功能都正常？</h3>
<p><strong>A:</strong> 執行以下檢查：</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="bash"><code><span class="line"><span style="color:#6A737D"># 1. 檢查型別</span></span>
<span class="line"><span style="color:#B392F0">npm</span><span style="color:#9ECBFF"> run</span><span style="color:#9ECBFF"> astro</span><span style="color:#9ECBFF"> check</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D"># 2. 建置測試</span></span>
<span class="line"><span style="color:#B392F0">npm</span><span style="color:#9ECBFF"> run</span><span style="color:#9ECBFF"> build</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D"># 3. 預覽網站</span></span>
<span class="line"><span style="color:#B392F0">npm</span><span style="color:#9ECBFF"> run</span><span style="color:#9ECBFF"> preview</span></span></code></pre>
<h2 id="升級效益">升級效益</h2>
<p>✅ <strong>更好的開發體驗</strong></p>
<ul>
<li>更精確的型別提示</li>
<li>更清晰的 API 命名</li>
</ul>
<p>✅ <strong>更快的建置速度</strong></p>
<ul>
<li>移除實驗性功能的 overhead</li>
<li>優化的 Content Collections</li>
</ul>
<p>✅ <strong>更好的效能</strong></p>
<ul>
<li>Prefetch 正式化</li>
<li>更輕量的 bundle</li>
</ul>
<h2 id="搭配-tailwindcss-v4-升級">搭配 TailwindCSS v4 升級</h2>
<p><strong>實際升級順序：</strong></p>
<p>本次專案升級順序為：</p>
<ol>
<li><strong>先升級 Astro 5.x</strong>（本文）</li>
<li><strong>再升級 TailwindCSS v4</strong>（<a href="/blog/tailwindcss/tailwind_v4_upgrade/">升級指南</a>）</li>
</ol>
<p><strong>為什麼這個順序？</strong></p>
<ul>
<li>✅ Astro 5.x 升級相對簡單，可以快速完成並驗證</li>
<li>✅ 先確保框架本身穩定，建立可靠的基礎</li>
<li>✅ TailwindCSS v4 改動較大（Sass 相容性問題），需要更多時間處理</li>
<li>✅ 避免同時調試多個問題，降低排錯難度</li>
<li>✅ 當 TailwindCSS 出問題時，至少 Astro 是穩定的</li>
</ul>
<p>這個順序讓整個升級過程更可控，推薦給同樣要做雙重升級的朋友！</p>
<h2 id="結語">結語</h2>
<p>Astro 5.x 的升級整體來說相對平順，主要是：</p>
<ol>
<li><strong>API 改名</strong> - ViewTransitions → ClientRouter</li>
<li><strong>型別改進</strong> - CollectionEntry 更精確</li>
<li><strong>清理實驗功能</strong> - 移除過時的 experimental 設定</li>
<li><strong>最佳實踐</strong> - 移除 any、優化載入</li>
</ol>
<p>相比 TailwindCSS v4 的升級，Astro 5.x 的變動小很多，大多是優化和改進，沒有重大的破壞性變更。</p>
<p>希望這篇文章能幫助你順利完成 Astro 5.x 升級！</p>
<h2 id="參考資源">參考資源</h2>
<ul>
<li><a href="https://astro.build/blog/astro-5/">Astro 5.0 發布公告</a></li>
<li><a href="https://docs.astro.build/en/guides/upgrade-to/v5/">Astro 5.x 遷移指南</a></li>
<li><a href="https://docs.astro.build/en/guides/view-transitions/">ClientRouter 文件</a></li>
<li><a href="https://docs.astro.build/en/guides/content-collections/">Content Collections 文件</a></li>
</ul> </div> </div> <div class="border-b border-default"> <div class="flex justify-between"> <a href="/blog/tailwindcss/tailwind_v4_upgrade" class="px-4 flex h-12 cursor-pointer items-center justify-center border-r border-default hover:bg-border"> <svg width="1em" height="1em" viewBox="0 0 15 15" class="mr-4 h-4 w-4" data-icon="teenyicons:left-outline">  <symbol id="ai:teenyicons:left-outline"><path fill="none" stroke="currentColor" stroke-linecap="square" d="M10 14L3 7.5L10 1"/></symbol><use  xlink:href="#ai:teenyicons:left-outline"></use>  </svg> Astro + TailwindCSS v4 升級實戰：從 v3 到 v4 的完整遷移指南 </a>  </div> </div> <div class="py-[3.35rem] px-[4vw]"> <!-- <hr class="my-8 text-gray-200" /> --><p class="text-lg">對這篇文章有什麼想法嗎?</p> <div id="blog-comments"></div> <script type="module">const e=localStorage.getItem("theme"),r=e==="light"?"github-light":"github-dark",t=document.createElement("script");t.type="text/javascript";t.src="https://utteranc.es/client.js";t.setAttribute("repo","mtwmt/mtwmt.github.io");t.setAttribute("issue-term","pathname");t.setAttribute("theme",r);t.setAttribute("crossorigin","anonymous");document.querySelector("#blog-comments")?.appendChild(t);</script> </div>   <footer class="animation relative bg-default lg:transition-none"> <div> <p class="p-4 text-right text-xs">
Copyright © 2025 Mandy. All rights reserved. Build with Astro
</p> </div> </footer> </article> <aside class="animation absolute -top-[152px] right-0 z-0 min-h-full w-80 origin-[center_right] bg-primary-800 scale-90 
  lg:scale-100
  lg:relative lg:top-0 lg:float-right lg:transition-none">  <ul data-blog-toc class="leading-[3rem] sticky top-0"><li class="h-12 border-b border-primary-700 bg-primary-900 px-3 text-primary-50">
文章導覽
</li><li class="h-12 border-b border-primary-700 text-primary-50 hover:bg-primary-700 hover:text-white"><a class="block w-full cursor-pointer px-3 " href="#前言" aria-label="Scroll to section: 前言">前言</a></li><li class="h-12 border-b border-primary-700 text-primary-50 hover:bg-primary-700 hover:text-white"><a class="block w-full cursor-pointer px-3 " href="#升級概述" aria-label="Scroll to section: 升級概述">升級概述</a></li><li class="h-12 border-b border-primary-700 text-primary-50 hover:bg-primary-700 hover:text-white"><a class="block w-full cursor-pointer px-3 " href="#第一階段升級核心套件" aria-label="Scroll to section: 第一階段：升級核心套件">第一階段：升級核心套件</a></li><li class="h-12 border-b border-primary-700 text-primary-50 hover:bg-primary-700 hover:text-white"><a class="block w-full cursor-pointer px-3 indent-4" href="#1-更新-astro-及相關套件" aria-label="Scroll to section: 1. 更新 Astro 及相關套件">1. 更新 Astro 及相關套件</a></li><li class="h-12 border-b border-primary-700 text-primary-50 hover:bg-primary-700 hover:text-white"><a class="block w-full cursor-pointer px-3 indent-4" href="#2-檢查重大變更" aria-label="Scroll to section: 2. 檢查重大變更">2. 檢查重大變更</a></li><li class="h-12 border-b border-primary-700 text-primary-50 hover:bg-primary-700 hover:text-white"><a class="block w-full cursor-pointer px-3 " href="#第二階段viewtransitions--clientrouter" aria-label="Scroll to section: 第二階段：ViewTransitions → ClientRouter">第二階段：ViewTransitions → ClientRouter</a></li><li class="h-12 border-b border-primary-700 text-primary-50 hover:bg-primary-700 hover:text-white"><a class="block w-full cursor-pointer px-3 indent-4" href="#問題viewtransitions-已棄用" aria-label="Scroll to section: 問題：ViewTransitions 已棄用">問題：ViewTransitions 已棄用</a></li><li class="h-12 border-b border-primary-700 text-primary-50 hover:bg-primary-700 hover:text-white"><a class="block w-full cursor-pointer px-3 indent-4" href="#解決方案更新所有引用" aria-label="Scroll to section: 解決方案：更新所有引用">解決方案：更新所有引用</a></li><li class="h-12 border-b border-primary-700 text-primary-50 hover:bg-primary-700 hover:text-white"><a class="block w-full cursor-pointer px-3 " href="#第三階段content-collections-優化" aria-label="Scroll to section: 第三階段：Content Collections 優化">第三階段：Content Collections 優化</a></li><li class="h-12 border-b border-primary-700 text-primary-50 hover:bg-primary-700 hover:text-white"><a class="block w-full cursor-pointer px-3 indent-4" href="#1-型別定義改進" aria-label="Scroll to section: 1. 型別定義改進">1. 型別定義改進</a></li><li class="h-12 border-b border-primary-700 text-primary-50 hover:bg-primary-700 hover:text-white"><a class="block w-full cursor-pointer px-3 indent-4" href="#2-getcollection-使用最佳實踐" aria-label="Scroll to section: 2. getCollection 使用最佳實踐">2. getCollection 使用最佳實踐</a></li><li class="h-12 border-b border-primary-700 text-primary-50 hover:bg-primary-700 hover:text-white"><a class="block w-full cursor-pointer px-3 " href="#第四階段清理未使用的程式碼" aria-label="Scroll to section: 第四階段：清理未使用的程式碼">第四階段：清理未使用的程式碼</a></li><li class="h-12 border-b border-primary-700 text-primary-50 hover:bg-primary-700 hover:text-white"><a class="block w-full cursor-pointer px-3 indent-4" href="#1-移除實驗性配置" aria-label="Scroll to section: 1. 移除實驗性配置">1. 移除實驗性配置</a></li><li class="h-12 border-b border-primary-700 text-primary-50 hover:bg-primary-700 hover:text-white"><a class="block w-full cursor-pointer px-3 indent-4" href="#2-清理註解掉的程式碼" aria-label="Scroll to section: 2. 清理註解掉的程式碼">2. 清理註解掉的程式碼</a></li><li class="h-12 border-b border-primary-700 text-primary-50 hover:bg-primary-700 hover:text-white"><a class="block w-full cursor-pointer px-3 " href="#第五階段typescript-最佳實踐" aria-label="Scroll to section: 第五階段：TypeScript 最佳實踐">第五階段：TypeScript 最佳實踐</a></li><li class="h-12 border-b border-primary-700 text-primary-50 hover:bg-primary-700 hover:text-white"><a class="block w-full cursor-pointer px-3 indent-4" href="#1-移除-any-型別" aria-label="Scroll to section: 1. 移除 any 型別">1. 移除 any 型別</a></li><li class="h-12 border-b border-primary-700 text-primary-50 hover:bg-primary-700 hover:text-white"><a class="block w-full cursor-pointer px-3 indent-4" href="#2-客戶端腳本型別安全" aria-label="Scroll to section: 2. 客戶端腳本型別安全">2. 客戶端腳本型別安全</a></li><li class="h-12 border-b border-primary-700 text-primary-50 hover:bg-primary-700 hover:text-white"><a class="block w-full cursor-pointer px-3 indent-4" href="#3-安全的-dom-操作" aria-label="Scroll to section: 3. 安全的 DOM 操作">3. 安全的 DOM 操作</a></li><li class="h-12 border-b border-primary-700 text-primary-50 hover:bg-primary-700 hover:text-white"><a class="block w-full cursor-pointer px-3 " href="#第六階段效能優化" aria-label="Scroll to section: 第六階段：效能優化">第六階段：效能優化</a></li><li class="h-12 border-b border-primary-700 text-primary-50 hover:bg-primary-700 hover:text-white"><a class="block w-full cursor-pointer px-3 indent-4" href="#1-prefetch-設定" aria-label="Scroll to section: 1. Prefetch 設定">1. Prefetch 設定</a></li><li class="h-12 border-b border-primary-700 text-primary-50 hover:bg-primary-700 hover:text-white"><a class="block w-full cursor-pointer px-3 indent-4" href="#2-移除未使用的依賴" aria-label="Scroll to section: 2. 移除未使用的依賴">2. 移除未使用的依賴</a></li><li class="h-12 border-b border-primary-700 text-primary-50 hover:bg-primary-700 hover:text-white"><a class="block w-full cursor-pointer px-3 indent-4" href="#3-icon-載入優化" aria-label="Scroll to section: 3. Icon 載入優化">3. Icon 載入優化</a></li><li class="h-12 border-b border-primary-700 text-primary-50 hover:bg-primary-700 hover:text-white"><a class="block w-full cursor-pointer px-3 " href="#關鍵知識點總結" aria-label="Scroll to section: 關鍵知識點總結">關鍵知識點總結</a></li><li class="h-12 border-b border-primary-700 text-primary-50 hover:bg-primary-700 hover:text-white"><a class="block w-full cursor-pointer px-3 indent-4" href="#1-api-名稱變更" aria-label="Scroll to section: 1. API 名稱變更">1. API 名稱變更</a></li><li class="h-12 border-b border-primary-700 text-primary-50 hover:bg-primary-700 hover:text-white"><a class="block w-full cursor-pointer px-3 indent-4" href="#2-typescript-改進" aria-label="Scroll to section: 2. TypeScript 改進">2. TypeScript 改進</a></li><li class="h-12 border-b border-primary-700 text-primary-50 hover:bg-primary-700 hover:text-white"><a class="block w-full cursor-pointer px-3 indent-4" href="#3-效能優化重點" aria-label="Scroll to section: 3. 效能優化重點">3. 效能優化重點</a></li><li class="h-12 border-b border-primary-700 text-primary-50 hover:bg-primary-700 hover:text-white"><a class="block w-full cursor-pointer px-3 " href="#驗證升級成功" aria-label="Scroll to section: 驗證升級成功">驗證升級成功</a></li><li class="h-12 border-b border-primary-700 text-primary-50 hover:bg-primary-700 hover:text-white"><a class="block w-full cursor-pointer px-3 indent-4" href="#1-建置測試" aria-label="Scroll to section: 1. 建置測試">1. 建置測試</a></li><li class="h-12 border-b border-primary-700 text-primary-50 hover:bg-primary-700 hover:text-white"><a class="block w-full cursor-pointer px-3 indent-4" href="#2-開發伺服器測試" aria-label="Scroll to section: 2. 開發伺服器測試">2. 開發伺服器測試</a></li><li class="h-12 border-b border-primary-700 text-primary-50 hover:bg-primary-700 hover:text-white"><a class="block w-full cursor-pointer px-3 indent-4" href="#3-功能測試" aria-label="Scroll to section: 3. 功能測試">3. 功能測試</a></li><li class="h-12 border-b border-primary-700 text-primary-50 hover:bg-primary-700 hover:text-white"><a class="block w-full cursor-pointer px-3 " href="#常見問題-faq" aria-label="Scroll to section: 常見問題 FAQ">常見問題 FAQ</a></li><li class="h-12 border-b border-primary-700 text-primary-50 hover:bg-primary-700 hover:text-white"><a class="block w-full cursor-pointer px-3 indent-4" href="#q1-viewtransitions-和-clientrouter-有什麼差別" aria-label="Scroll to section: Q1: ViewTransitions 和 ClientRouter 有什麼差別？">Q1: ViewTransitions 和 ClientRouter 有什麼差別？</a></li><li class="h-12 border-b border-primary-700 text-primary-50 hover:bg-primary-700 hover:text-white"><a class="block w-full cursor-pointer px-3 indent-4" href="#q2-升級後-content-collections-報錯怎麼辦" aria-label="Scroll to section: Q2: 升級後 Content Collections 報錯怎麼辦？">Q2: 升級後 Content Collections 報錯怎麼辦？</a></li><li class="h-12 border-b border-primary-700 text-primary-50 hover:bg-primary-700 hover:text-white"><a class="block w-full cursor-pointer px-3 indent-4" href="#q3-需要更新所有-astrojs-套件嗎" aria-label="Scroll to section: Q3: 需要更新所有 @astrojs/* 套件嗎？">Q3: 需要更新所有 @astrojs/* 套件嗎？</a></li><li class="h-12 border-b border-primary-700 text-primary-50 hover:bg-primary-700 hover:text-white"><a class="block w-full cursor-pointer px-3 indent-4" href="#q4-prefetch-會影響效能嗎" aria-label="Scroll to section: Q4: prefetch 會影響效能嗎？">Q4: prefetch 會影響效能嗎？</a></li><li class="h-12 border-b border-primary-700 text-primary-50 hover:bg-primary-700 hover:text-white"><a class="block w-full cursor-pointer px-3 indent-4" href="#q5-如何確認所有功能都正常" aria-label="Scroll to section: Q5: 如何確認所有功能都正常？">Q5: 如何確認所有功能都正常？</a></li><li class="h-12 border-b border-primary-700 text-primary-50 hover:bg-primary-700 hover:text-white"><a class="block w-full cursor-pointer px-3 " href="#升級效益" aria-label="Scroll to section: 升級效益">升級效益</a></li><li class="h-12 border-b border-primary-700 text-primary-50 hover:bg-primary-700 hover:text-white"><a class="block w-full cursor-pointer px-3 " href="#搭配-tailwindcss-v4-升級" aria-label="Scroll to section: 搭配 TailwindCSS v4 升級">搭配 TailwindCSS v4 升級</a></li><li class="h-12 border-b border-primary-700 text-primary-50 hover:bg-primary-700 hover:text-white"><a class="block w-full cursor-pointer px-3 " href="#結語" aria-label="Scroll to section: 結語">結語</a></li><li class="h-12 border-b border-primary-700 text-primary-50 hover:bg-primary-700 hover:text-white"><a class="block w-full cursor-pointer px-3 " href="#參考資源" aria-label="Scroll to section: 參考資源">參考資源</a></li></ul><script type="module">const n=e=>{for(let t of e){const{id:o}=t.target,r=document.querySelector(`[data-blog-toc] a[href="#${o}"]`);if(!r)return;t.isIntersecting&&(document.querySelectorAll("[data-blog-toc] a").forEach(c=>c.classList.remove("active")),r.classList.add("active"))}},s={root:null,rootMargin:"0px 0px -180px",threshold:1},a=new IntersectionObserver(n,s);document.querySelectorAll("article :is(h2,h3,h4)").forEach(e=>a.observe(e));</script><!-- https://www.fazzaamiarso.me/blog/toc-astro-spy/#create-the-component --><!-- <script>
    //---------------   Click Expand   ---------------
    let toggler = document.getElementsByClassName("toc_expand");
    for (let i = 0; i < toggler.length; i++) {
      toggler[i].addEventListener("click", function(e) {
        this.parentElement.parentElement.querySelector("ul")?.classList.toggle("hidden");
        this.parentElement.classList.toggle("expanded");
        e.preventDefault()
      });
    }


    //---------------   Scroll Spy   ---------------
    function escape_href(href){
        //the # bothers CSS.escape in case of id starting with a number
        return `#${CSS.escape(href.replace('#',''))}`
    }

    const article = document.querySelector( 'article.content' )
    const hrefs = document.getElementsByClassName("toc_href");
    const targets = [...hrefs].map(el => article.querySelector(escape_href(el.getAttribute('href'))))
    
    article.addEventListener("scroll", (event) => {
        let spy = null//if no element on screen, keep last match and do nothing
        for ( let t in targets ){//find first within visible scroll
            if(targets[ t ].offsetTop > article.scrollTop){
                spy = targets[ t ]
                break
            }
        }
        if(spy){
            document.querySelector(".toc_href.active")?.classList.remove("active");
            document.querySelector(".heading.active")?.classList.remove("active");
            const id = spy.id
            //console.log(id)
            document.querySelector(`a[href="#${id}"].toc_href`)?.classList.add("active")
            document.getElementById(id)?.classList.add("active")
        }
    })

    const href_els = document.querySelectorAll(".toc_href");
    href_els.forEach(element => {
        element.addEventListener('mouseenter',()=>{
            const href = element.getAttribute('href')
            const id = href.slice(1,href.length)
            document.getElementById(id)?.classList.add("hover")
        })        
        element.addEventListener('mouseout',()=>{
            const href = element.getAttribute('href')
            const id = href.slice(1,href.length)
            document.getElementById(id)?.classList.remove("hover")
        })        
    });
</script> -->  </aside> <!-- <aside class="animation scale-90 origin-[center_right] bg-primary-800 
  absolute w-[calc(20rem-1px)] top-12 right-0  overflow-hidden
  lg:relative lg:top-0 lg:float-right lg:scale-100  lg:transition-none lg:overflow-visible
  before:block before:fixed before:w-[1px] before:h-screen before:top-0 before:ml-[calc(20rem-2px)] before:bg-primary-800
  ">
  <slot />
</aside>

<style is:global lang="scss">
  .nav-toggle:checked {
    & ~ aside {
      @apply scale-100;
		}
  }
  
</style>
 --> </main>   </div> </body></html> <div data-gotop class="cursor-pointer fixed bottom-16 right-8 z-50 transition duration-300"> <svg width="1em" height="1em" viewBox="0 0 24 24" class="btn w-10 h-10 bg-white" data-icon="ic:outline-keyboard-arrow-up">  <symbol id="ai:ic:outline-keyboard-arrow-up"><path fill="currentColor" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6l-6 6z"/></symbol><use  xlink:href="#ai:ic:outline-keyboard-arrow-up"></use>  </svg> </div> <script type="module">const o=document.querySelector("[data-gotop]"),t=document.querySelector("header")?.offsetHeight||0,e=()=>{(window.scrollY||0)>t?(o?.classList.add("opacity-100"),o?.classList.remove("opacity-0")):(o?.classList.add("opacity-0"),o?.classList.remove("opacity-100"))};e();window.addEventListener("scroll",e);o?.addEventListener("click",function(){document.querySelector("html, body")?.scrollIntoView({behavior:"smooth",block:"start",inline:"nearest"})});</script> <script type="module">const n=document.querySelectorAll(".post");n.forEach(e=>{e.querySelectorAll("a").forEach(t=>{t.setAttribute("target","_blank")})});let c="Copy Code",l=Array.from(document.querySelectorAll("pre"));for(let e of l){let o=document.createElement("div");o.className="relative";let t=document.createElement("button");t.className="copy-code",t.innerHTML=c,e.setAttribute("tabindex","0"),e.appendChild(t),e.parentNode?.insertBefore(o,e),o.appendChild(e),t.addEventListener("click",async()=>{await a(e,t)})}async function a(e,o){let r=e.querySelector("code")?.innerText||"";await navigator.clipboard.writeText(r),o.innerText="Code Copied",setTimeout(()=>{o.innerText=c},700)}</script>