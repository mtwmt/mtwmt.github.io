<!DOCTYPE html><html lang="en"> <head><!-- Global Metadata --><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><link rel="icon" type="image/svg+xml" href="/favicon.svg"><meta name="generator" content="Astro v5.14.1"><!-- Canonical URL --><link rel="canonical" href="https://mtwmt.com/blog/tailwindcss/tailwind_v4_upgrade/"><!-- Primary Meta Tags --><title>Astro + TailwindCSS v4 升級實戰：從 v3 到 v4 的完整遷移指南 | Mandy&#39;s Website</title><meta name="title" content="Astro + TailwindCSS v4 升級實戰：從 v3 到 v4 的完整遷移指南 | Mandy's Website"><meta name="description" content="前言最近將部落格從TailwindCSSv3.4.18升級到v4.1.14，過程中踩了不少坑，特別是自訂顏色完全消失的問題讓我困擾了很久。這篇文章記錄完整的升級過程和解決方案，希望能幫助到有相同需求的"><meta name="robots" content="index, follow"><!-- Open Graph / Facebook --><meta property="og:type" content="website"><meta property="og:url" content="https://mtwmt.com/blog/tailwindcss/tailwind_v4_upgrade/"><meta property="og:title" content="Astro + TailwindCSS v4 升級實戰：從 v3 到 v4 的完整遷移指南 | Mandy's Website"><meta property="og:description" content="前言最近將部落格從TailwindCSSv3.4.18升級到v4.1.14，過程中踩了不少坑，特別是自訂顏色完全消失的問題讓我困擾了很久。這篇文章記錄完整的升級過程和解決方案，希望能幫助到有相同需求的"><meta property="og:image" content="https://mtwmt.com/placeholder-social.jpg"><!-- Twitter --><meta property="twitter:card" content="summary_large_image"><meta property="twitter:url" content="https://mtwmt.com/blog/tailwindcss/tailwind_v4_upgrade/"><meta property="twitter:title" content="Astro + TailwindCSS v4 升級實戰：從 v3 到 v4 的完整遷移指南 | Mandy's Website"><meta property="twitter:description" content="前言最近將部落格從TailwindCSSv3.4.18升級到v4.1.14，過程中踩了不少坑，特別是自訂顏色完全消失的問題讓我困擾了很久。這篇文章記錄完整的升級過程和解決方案，希望能幫助到有相同需求的"><meta property="twitter:image" content="https://mtwmt.com/placeholder-social.jpg"><meta name="astro-view-transitions-enabled" content="true"><meta name="astro-view-transitions-fallback" content="animate"><script type="module" src="/_astro/ClientRouter.astro_astro_type_script_index_0_lang.BBA8qn6T.js"></script><!-- Google tag (gtag.js) --><script async src="https://www.googletagmanager.com/gtag/js?id=G-N8NEZBWT3S"></script><script type="module">window.dataLayer=window.dataLayer||[];function a(){dataLayer.push(arguments)}a("js",new Date);a("config","G-N8NEZBWT3S");</script><link rel="stylesheet" href="/_astro/about.BnbaqN3h.css"><script type="module" src="/_astro/page.CPvyyiTs.js"></script></head> <body class="bg-default text-default"> <div class="relative mx-auto 
      before:fixed before:right-0 before:top-0 before:block before:w-80 
      lg:before:h-screen before:bg-primary-900 before:transition 
      lg:max-w-7xl lg:before:w-1/2">  <input id="nav-toggle" type="checkbox" class="hidden nav-toggle"> <header class="bg-primary-900 lg:flex lg:h-[180px] lg:flex-row-reverse lg:justify-between"> <div class="translate-x-0 animation relative w-full font-dosis lg:flex lg:h-full lg:w-80 lg:items-center lg:justify-center lg:bg-primary-500 lg:transition-none"> <h2 class="w-40 bg-primary-500 text-center text-2xl leading-loose text-white lg:w-auto lg:text-4xl"> <a href="/">Mandy's Web</a> </h2> <label id="hamburger" for="nav-toggle" title="MENU" class="absolute right-5 top-1/2 h-7 w-8 -translate-y-1/2 cursor-pointer lg:hidden"> <span class="animation absolute top-1/2 h-[2px] w-full -translate-y-1/2 bg-white before:absolute before:-top-2.5 before:h-[2px] before:w-full before:bg-white after:absolute after:top-2.5 after:h-[2px] after:w-full after:bg-white lg:transition-none"></span></label> </div> <div class="translate-x-0 animation relative z-10 bg-light py-4 text-center lg:flex lg:w-[calc(100%-20rem)] lg:flex-row-reverse lg:items-center lg:justify-between lg:px-[4vw] lg:transition-none"> <p class="mb-4 lg:mb-0">因為會忘，所以要寫下來</p> <nav> <ul class="flex justify-center font-dosis uppercase lg:justify-start"> <li class="mx-4 text-center "> <a href="/about"> <span class="flex justify-center items-center mb-2 h-12 w-12 rounded-[50%] border border-neutral-300 text-center leading-[46px]"> <svg width="1em" height="1em" viewBox="0 0 24 24" class="h-6 w-6 " data-icon="ic:outline-question-mark">  <symbol id="ai:ic:outline-question-mark"><path fill="currentColor" d="M11.07 12.85c.77-1.39 2.25-2.21 3.11-3.44c.91-1.29.4-3.7-2.18-3.7c-1.69 0-2.52 1.28-2.87 2.34L6.54 6.96C7.25 4.83 9.18 3 11.99 3c2.35 0 3.96 1.07 4.78 2.41c.7 1.15 1.11 3.3.03 4.9c-1.2 1.77-2.35 2.31-2.97 3.45c-.25.46-.35.76-.35 2.24h-2.89c-.01-.78-.13-2.05.48-3.15M14 20c0 1.1-.9 2-2 2s-2-.9-2-2s.9-2 2-2s2 .9 2 2"/></symbol><use  xlink:href="#ai:ic:outline-question-mark"></use>  </svg> </span> about </a> </li><li class="mx-4 text-center "> <a href="/blog/page/1"> <span class="flex justify-center items-center mb-2 h-12 w-12 rounded-[50%] border border-neutral-300 text-center leading-[46px]"> <svg width="1em" height="1em" viewBox="0 0 24 24" class="h-6 w-6 " data-icon="ic:outline-format-bold">  <symbol id="ai:ic:outline-format-bold"><path fill="currentColor" d="M15.6 10.79c.97-.67 1.65-1.77 1.65-2.79c0-2.26-1.75-4-4-4H7v14h7.04c2.09 0 3.71-1.7 3.71-3.79c0-1.52-.86-2.82-2.15-3.42M10 6.5h3c.83 0 1.5.67 1.5 1.5s-.67 1.5-1.5 1.5h-3zm3.5 9H10v-3h3.5c.83 0 1.5.67 1.5 1.5s-.67 1.5-1.5 1.5"/></symbol><use  xlink:href="#ai:ic:outline-format-bold"></use>  </svg> </span> blog </a> </li><li class="mx-4 text-center "> <a href="/contact"> <span class="flex justify-center items-center mb-2 h-12 w-12 rounded-[50%] border border-neutral-300 text-center leading-[46px]"> <svg width="1em" height="1em" viewBox="0 0 24 24" class="h-6 w-6 " data-icon="ic:outline-mode-comment">  <symbol id="ai:ic:outline-mode-comment"><path fill="currentColor" d="M20 17.17L18.83 16H4V4h16zM20 2H4c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h14l4 4V4c0-1.1-.9-2-2-2"/></symbol><use  xlink:href="#ai:ic:outline-mode-comment"></use>  </svg> </span> submit </a> </li> <li class="mx-4 text-center"> <div class="inline-flex undefined"> <input class="absolute opacity-0" id="theme-switcher" data-theme-switcher type="checkbox"> <label class="relative" for="theme-switcher"> <span class="cursor-pointer flex justify-center items-center mb-2 h-12 w-12 rounded-[50%] border border-neutral-300 text-center leading-[46px]"> <svg width="1em" height="1em" viewBox="0 0 24 24" class="h-6 w-6 hidden dark:block" data-icon="ic:outline-dark-mode">  <symbol id="ai:ic:outline-dark-mode"><path fill="currentColor" d="M9.37 5.51A7.4 7.4 0 0 0 9.1 7.5c0 4.08 3.32 7.4 7.4 7.4c.68 0 1.35-.09 1.99-.27A7.01 7.01 0 0 1 12 19c-3.86 0-7-3.14-7-7c0-2.93 1.81-5.45 4.37-6.49M12 3a9 9 0 1 0 9 9c0-.46-.04-.92-.1-1.36a5.39 5.39 0 0 1-4.4 2.26a5.403 5.403 0 0 1-3.14-9.8c-.44-.06-.9-.1-1.36-.1"/></symbol><use  xlink:href="#ai:ic:outline-dark-mode"></use>  </svg> <svg width="1em" height="1em" viewBox="0 0 24 24" class="h-6 w-6 block dark:hidden" data-icon="ic:outline-light-mode">  <symbol id="ai:ic:outline-light-mode"><path fill="currentColor" d="M12 9c1.65 0 3 1.35 3 3s-1.35 3-3 3s-3-1.35-3-3s1.35-3 3-3m0-2c-2.76 0-5 2.24-5 5s2.24 5 5 5s5-2.24 5-5s-2.24-5-5-5M2 13h2c.55 0 1-.45 1-1s-.45-1-1-1H2c-.55 0-1 .45-1 1s.45 1 1 1m18 0h2c.55 0 1-.45 1-1s-.45-1-1-1h-2c-.55 0-1 .45-1 1s.45 1 1 1M11 2v2c0 .55.45 1 1 1s1-.45 1-1V2c0-.55-.45-1-1-1s-1 .45-1 1m0 18v2c0 .55.45 1 1 1s1-.45 1-1v-2c0-.55-.45-1-1-1s-1 .45-1 1M5.99 4.58a.996.996 0 0 0-1.41 0a.996.996 0 0 0 0 1.41l1.06 1.06c.39.39 1.03.39 1.41 0s.39-1.03 0-1.41zm12.37 12.37a.996.996 0 0 0-1.41 0a.996.996 0 0 0 0 1.41l1.06 1.06c.39.39 1.03.39 1.41 0a.996.996 0 0 0 0-1.41zm1.06-10.96a.996.996 0 0 0 0-1.41a.996.996 0 0 0-1.41 0l-1.06 1.06c-.39.39-.39 1.03 0 1.41s1.03.39 1.41 0zM7.05 18.36a.996.996 0 0 0 0-1.41a.996.996 0 0 0-1.41 0l-1.06 1.06c-.39.39-.39 1.03 0 1.41s1.03.39 1.41 0z"/></symbol><use  xlink:href="#ai:ic:outline-light-mode"></use>  </svg> </span>
mode
</label> </div> <script type="module">const a=()=>{const e=(()=>typeof localStorage<"u"&&localStorage.getItem("theme")?localStorage.getItem("theme")==="dark":!!window.matchMedia("(prefers-color-scheme: dark)").matches),c=document.querySelectorAll("[data-theme-switcher]");e()&&document.documentElement.classList.add("dark"),[].forEach.call(c,function(t){t.checked=!!e(),t.addEventListener("click",()=>{document.documentElement.classList.toggle("dark"),localStorage.setItem("theme",document.documentElement.classList.contains("dark")?"dark":"light")})})};document.addEventListener("astro:after-swap",a);a();</script> </li> </ul> </nav> </div> </header>  <main class="relative z-[1] block min-h-full overflow-hidden
  before:fixed before:top-0 before:left-1/2 before:ml-[640px] before:block before:h-full before:min-h-screen before:w-[1px] 
  before:bg-primary-500 after:fixed after:top-0 after:right-1/2 
  after:mr-[640px] after:block after:h-full after:min-h-screen after:w-[1px] after:bg-border lg:flex"> <article class=" min-h-[calc(100vh-180px)]  animation relative z-[1] bg-default lg:float-left lg:w-[calc(100%-20rem)] lg:transition-none">   <div class="py-[3.35rem] px-[4vw]"> <time>Oct 4, 2025</time><!-- <div class=` ${className}`>
	<span class="text-6xl font-bold block">{
		new Date(date).getDate().toString().padStart(2, '0')
	}</span>
	<span>{
		`${date.toLocaleDateString('en-us', {
			month: 'short',
		})} ${new Date(date).getFullYear()}`
	}</span>
</div>  --> <h1 class="text-3xl leading-loose text-default">Astro + TailwindCSS v4 升級實戰：從 v3 到 v4 的完整遷移指南</h1> <p class>13 minutes to read</p> <div class="mt-2"> <a href="/blog/tags/tailwindcss" class="px-2 py-1 mr-2 text-xs font-normal border rounded-md border-primary-100 text-primary-500 bg-primary-50
        dark:border-primary-400 dark:bg-primary-500 dark:text-primary-50
        ">tailwindcss</a><a href="/blog/tags/astro" class="px-2 py-1 mr-2 text-xs font-normal border rounded-md border-primary-100 text-primary-500 bg-primary-50
        dark:border-primary-400 dark:bg-primary-500 dark:text-primary-50
        ">astro</a><a href="/blog/tags/css" class="px-2 py-1 mr-2 text-xs font-normal border rounded-md border-primary-100 text-primary-500 bg-primary-50
        dark:border-primary-400 dark:bg-primary-500 dark:text-primary-50
        ">css</a> </div> </div> <div class="border-y border-default py-10 px-[4vw]"> <div class="post"> <h2 id="前言">前言</h2>
<p>最近將部落格從 TailwindCSS v3.4.18 升級到 v4.1.14，過程中踩了不少坑，特別是自訂顏色完全消失的問題讓我困擾了很久。這篇文章記錄完整的升級過程和解決方案，希望能幫助到有相同需求的朋友。</p>
<h2 id="升級概述">升級概述</h2>
<p><strong>專案環境：</strong></p>
<ul>
<li>Astro 5.14.1</li>
<li>TailwindCSS 3.4.18 → 4.1.14</li>
<li>使用 SCSS 作為樣式預處理器</li>
<li>有大量自訂 primary 顏色</li>
</ul>
<p><strong>主要變更：</strong></p>
<ul>
<li><code>@astrojs/tailwind</code> → <code>@tailwindcss/vite</code></li>
<li><code>tailwind.config.js</code> → CSS-based 配置</li>
<li>Sass <code>@import</code> → <code>@reference</code> 指令</li>
</ul>
<h2 id="第一階段基本升級">第一階段：基本升級</h2>
<h3 id="1-安裝新版本">1. 安裝新版本</h3>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="bash"><code><span class="line"><span style="color:#B392F0">npm</span><span style="color:#9ECBFF"> install</span><span style="color:#9ECBFF"> tailwindcss@4.1.14</span><span style="color:#9ECBFF"> @tailwindcss/vite@4.1.14</span></span>
<span class="line"><span style="color:#B392F0">npm</span><span style="color:#9ECBFF"> uninstall</span><span style="color:#9ECBFF"> @astrojs/tailwind</span></span></code></pre>
<h3 id="2-更新-astro-配置">2. 更新 Astro 配置</h3>
<p><strong>astro.config.mjs：</strong></p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="javascript"><code><span class="line"><span style="color:#F97583">import</span><span style="color:#E1E4E8"> { defineConfig } </span><span style="color:#F97583">from</span><span style="color:#9ECBFF"> 'astro/config'</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#F97583">import</span><span style="color:#E1E4E8"> sitemap </span><span style="color:#F97583">from</span><span style="color:#9ECBFF"> '@astrojs/sitemap'</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#F97583">import</span><span style="color:#E1E4E8"> mdx </span><span style="color:#F97583">from</span><span style="color:#9ECBFF"> '@astrojs/mdx'</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#F97583">import</span><span style="color:#E1E4E8"> icon </span><span style="color:#F97583">from</span><span style="color:#9ECBFF"> 'astro-icon'</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#F97583">import</span><span style="color:#E1E4E8"> tailwindcss </span><span style="color:#F97583">from</span><span style="color:#9ECBFF"> '@tailwindcss/vite'</span><span style="color:#E1E4E8">; </span><span style="color:#6A737D">// 新的 Vite 插件</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">export</span><span style="color:#F97583"> default</span><span style="color:#B392F0"> defineConfig</span><span style="color:#E1E4E8">({</span></span>
<span class="line"><span style="color:#E1E4E8">  site: </span><span style="color:#9ECBFF">'https://mtwmt.com'</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#E1E4E8">  integrations: [</span></span>
<span class="line"><span style="color:#B392F0">    sitemap</span><span style="color:#E1E4E8">(),</span></span>
<span class="line"><span style="color:#B392F0">    mdx</span><span style="color:#E1E4E8">(),</span></span>
<span class="line"><span style="color:#B392F0">    icon</span><span style="color:#E1E4E8">({</span></span>
<span class="line"><span style="color:#E1E4E8">      include: {</span></span>
<span class="line"><span style="color:#9ECBFF">        'grommet-icons'</span><span style="color:#E1E4E8">: [</span><span style="color:#9ECBFF">'*'</span><span style="color:#E1E4E8">],</span></span>
<span class="line"><span style="color:#6A737D">        // ... 其他 icon 集</span></span>
<span class="line"><span style="color:#E1E4E8">      },</span></span>
<span class="line"><span style="color:#E1E4E8">    }),</span></span>
<span class="line"><span style="color:#E1E4E8">  ],</span></span>
<span class="line"><span style="color:#E1E4E8">  vite: {</span></span>
<span class="line"><span style="color:#E1E4E8">    plugins: [</span><span style="color:#B392F0">tailwindcss</span><span style="color:#E1E4E8">()], </span><span style="color:#6A737D">// 在 vite 中使用</span></span>
<span class="line"><span style="color:#E1E4E8">  },</span></span>
<span class="line"><span style="color:#E1E4E8">  prefetch: </span><span style="color:#79B8FF">true</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#E1E4E8">});</span></span></code></pre>
<p><strong>重要：</strong> TailwindCSS v4 不再作為 Astro integration，改為 Vite plugin。</p>
<h3 id="3-刪除舊配置">3. 刪除舊配置</h3>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="bash"><code><span class="line"><span style="color:#B392F0">rm</span><span style="color:#9ECBFF"> tailwind.config.cjs</span><span style="color:#6A737D">  # 不再需要 JS 配置檔</span></span></code></pre>
<h2 id="第二階段處理-sass-衝突">第二階段：處理 Sass 衝突</h2>
<h3 id="問題自訂顏色完全消失">問題：自訂顏色完全消失</h3>
<p>升級後發現所有 <code>bg-primary-500</code>、<code>text-primary-700</code> 等自訂顏色都不見了！</p>
<p><strong>根本原因：</strong>
TailwindCSS v4 <strong>不支援 Sass 預處理器</strong>處理 <code>@theme</code> 指令。當 Sass 預處理 <code>@import "tailwindcss"</code> 時，會破壞 TailwindCSS 的元數據，導致自訂顏色的 utility classes 無法生成。</p>
<h3 id="解決方案完全改用純-css">解決方案：完全改用純 CSS</h3>
<p><strong>最終策略：</strong> 放棄在主樣式表使用 SCSS，改用純 CSS + TailwindCSS v4 特性。</p>
<h4 id="1-建立-tailwindcss">1. 建立 <code>tailwind.css</code></h4>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="css"><code><span class="line"><span style="color:#6A737D">/* src/styles/tailwind.css */</span></span>
<span class="line"><span style="color:#F97583">@import</span><span style="color:#9ECBFF"> "tailwindcss"</span><span style="color:#E1E4E8">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">@theme</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#6A737D">  /* Font families - 注意：使用 --font-* 而非 --font-family-* */</span></span>
<span class="line"><span style="color:#E1E4E8">  --font-dosis: "Dosis", </span><span style="color:#85E89D">sans-serif</span><span style="color:#E1E4E8">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D">  /* Primary color palette */</span></span>
<span class="line"><span style="color:#E1E4E8">  --color-primary-50: </span><span style="color:#FDAEB7;font-style:italic">#e0f5f5;</span></span>
<span class="line"><span style="color:#E1E4E8">  --color-primary-100: </span><span style="color:#FDAEB7;font-style:italic">#b3e6e6;</span></span>
<span class="line"><span style="color:#E1E4E8">  --color-primary-200: </span><span style="color:#FDAEB7;font-style:italic">#80d5d5</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#E1E4E8">  --color-primary-300: </span><span style="color:#FDAEB7;font-style:italic">#4dc4c4</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#E1E4E8">  --color-primary-400: </span><span style="color:#FDAEB7;font-style:italic">#26b7b7</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#E1E4E8">  --color-primary-500: </span><span style="color:#FDAEB7;font-style:italic">#00aaaa</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#E1E4E8">  --color-primary-600: </span><span style="color:#FDAEB7;font-style:italic">#00a3a3</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#E1E4E8">  --color-primary-700: </span><span style="color:#FDAEB7;font-style:italic">#009999</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#E1E4E8">  --color-primary-800: </span><span style="color:#FDAEB7;font-style:italic">#009090</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#E1E4E8">  --color-primary-900: </span><span style="color:#FDAEB7;font-style:italic">#007f7f</span><span style="color:#E1E4E8">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D">  /* Additional shades */</span></span>
<span class="line"><span style="color:#E1E4E8">  --color-primary-a100: </span><span style="color:#FDAEB7;font-style:italic">#adffff;</span></span>
<span class="line"><span style="color:#E1E4E8">  --color-primary-a200: </span><span style="color:#FDAEB7;font-style:italic">#7affff</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#E1E4E8">  --color-primary-a400: </span><span style="color:#FDAEB7;font-style:italic">#47ffff</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#E1E4E8">  --color-primary-a700: </span><span style="color:#FDAEB7;font-style:italic">#2dffff</span><span style="color:#E1E4E8">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D">  /* Light color palette */</span></span>
<span class="line"><span style="color:#E1E4E8">  --color-light-50: </span><span style="color:#FDAEB7;font-style:italic">#fff;</span></span>
<span class="line"><span style="color:#E1E4E8">  --color-light-100: </span><span style="color:#FDAEB7;font-style:italic">#f5f5f5;</span></span>
<span class="line"><span style="color:#E1E4E8">  --color-light-200: </span><span style="color:#FDAEB7;font-style:italic">#ddd;</span></span>
<span class="line"><span style="color:#E1E4E8">  --color-light-300: </span><span style="color:#FDAEB7;font-style:italic">#717171</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#E1E4E8">  --color-light-400: </span><span style="color:#FDAEB7;font-style:italic">#444</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#E1E4E8">  --color-light-500: </span><span style="color:#FDAEB7;font-style:italic">#040404</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span></code></pre>
<p><strong>重要：</strong> 字體定義必須使用 <code>--font-dosis</code> 而非 <code>--font-family-dosis</code>，這樣才能正確生成 <code>font-dosis</code> utility class。</p>
<h4 id="2-將-globalscss-轉換為-globalcss">2. 將 <code>global.scss</code> 轉換為 <code>global.css</code></h4>
<p>TailwindCSS v4 在獨立樣式表中使用 <code>@apply</code> 時，<strong>無法套用自訂的 utility classes</strong>（如 <code>text-default</code>、<code>bg-light</code>）。解決方法：</p>
<ol>
<li>將 <code>global.scss</code> 重新命名為 <code>global.css</code></li>
<li>展開所有 Sass 巢狀語法（<code>&#x26;</code> 符號）</li>
<li>將自訂 utilities 移出 <code>@layer utilities</code></li>
<li>在 <code>@apply</code> 中無法使用的自訂 utilities，改用 CSS 變數</li>
</ol>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="css"><code><span class="line"><span style="color:#6A737D">/* src/styles/global.css */</span></span>
<span class="line"><span style="color:#F97583">@import</span><span style="color:#79B8FF"> url</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">"https://fonts.googleapis.com/css?family=Dosis:300,400,500,600,700"</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#F97583">@import</span><span style="color:#9ECBFF"> "./tailwind.css"</span><span style="color:#E1E4E8">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">@layer</span><span style="color:#E1E4E8"> base {</span></span>
<span class="line"><span style="color:#85E89D">  *</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#E1E4E8">    @</span><span style="color:#79B8FF">apply</span><span style="color:#79B8FF"> box-border</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#E1E4E8">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0">  :root</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#6A737D">    /* Runtime CSS 變數 */</span></span>
<span class="line"><span style="color:#FFAB70">    --color-default</span><span style="color:#E1E4E8">: </span><span style="color:#79B8FF">#444</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#FFAB70">    --color-light</span><span style="color:#E1E4E8">: </span><span style="color:#79B8FF">#717171</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#FFAB70">    --color-dark</span><span style="color:#E1E4E8">: </span><span style="color:#79B8FF">#040404</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#FFAB70">    --color-background</span><span style="color:#E1E4E8">: </span><span style="color:#79B8FF">#fff</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#FFAB70">    --color-light-background</span><span style="color:#E1E4E8">: </span><span style="color:#79B8FF">#f5f5f5</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#FFAB70">    --color-border</span><span style="color:#E1E4E8">: </span><span style="color:#79B8FF">#ddd</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#E1E4E8">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0">  :root.dark</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#6A737D">    /* Dark mode 覆蓋 */</span></span>
<span class="line"><span style="color:#FFAB70">    --color-default</span><span style="color:#E1E4E8">: </span><span style="color:#79B8FF">#fff</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#FFAB70">    --color-light</span><span style="color:#E1E4E8">: </span><span style="color:#79B8FF">#fff</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#FFAB70">    --color-dark</span><span style="color:#E1E4E8">: </span><span style="color:#79B8FF">#B4AFB6</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#FFAB70">    --color-background</span><span style="color:#E1E4E8">: </span><span style="color:#79B8FF">#1c1c1c</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#FFAB70">    --color-light-background</span><span style="color:#E1E4E8">: </span><span style="color:#79B8FF">#404040</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#FFAB70">    --color-border</span><span style="color:#E1E4E8">: </span><span style="color:#79B8FF">#666</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#E1E4E8">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#85E89D">  html</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#85E89D">  body</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#E1E4E8">    @</span><span style="color:#79B8FF">apply</span><span style="color:#79B8FF"> relative</span><span style="color:#79B8FF"> m-</span><span style="color:#E1E4E8">0 </span><span style="color:#79B8FF">h-full</span><span style="color:#79B8FF"> w-full</span><span style="color:#79B8FF"> p-</span><span style="color:#E1E4E8">0;</span></span>
<span class="line"><span style="color:#79B8FF">    scroll-behavior</span><span style="color:#E1E4E8">: </span><span style="color:#79B8FF">smooth</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#E1E4E8">  }</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D">/* 自訂 utilities - 移出 @layer 以便給 HTML 直接使用 */</span></span>
<span class="line"><span style="color:#B392F0">.text-default</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#79B8FF">  color</span><span style="color:#E1E4E8">: </span><span style="color:#79B8FF">var</span><span style="color:#E1E4E8">(</span><span style="color:#FFAB70">--color-default</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span>
<span class="line"><span style="color:#B392F0">.bg-default</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#79B8FF">  background-color</span><span style="color:#E1E4E8">: </span><span style="color:#79B8FF">var</span><span style="color:#E1E4E8">(</span><span style="color:#FFAB70">--color-background</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span>
<span class="line"><span style="color:#B392F0">.border-default</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#79B8FF">  border-color</span><span style="color:#E1E4E8">: </span><span style="color:#79B8FF">var</span><span style="color:#E1E4E8">(</span><span style="color:#FFAB70">--color-border</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D">/* Blog 文章樣式 - 混用 @apply 和 CSS 變數 */</span></span>
<span class="line"><span style="color:#B392F0">.post</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#E1E4E8">  @</span><span style="color:#79B8FF">apply</span><span style="color:#79B8FF"> text-base</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#79B8FF">  color</span><span style="color:#E1E4E8">: </span><span style="color:#79B8FF">var</span><span style="color:#E1E4E8">(</span><span style="color:#FFAB70">--color-default</span><span style="color:#E1E4E8">); </span><span style="color:#6A737D">/* 不能用 @apply text-default */</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0">.post</span><span style="color:#85E89D"> h1</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#E1E4E8">  @</span><span style="color:#79B8FF">apply</span><span style="color:#79B8FF"> my-</span><span style="color:#E1E4E8">4 </span><span style="color:#79B8FF">text-</span><span style="color:#E1E4E8">3</span><span style="color:#79B8FF">xl</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#79B8FF">  color</span><span style="color:#E1E4E8">: </span><span style="color:#79B8FF">var</span><span style="color:#E1E4E8">(</span><span style="color:#FFAB70">--color-default</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0">.post</span><span style="color:#85E89D"> hr</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#E1E4E8">  @</span><span style="color:#79B8FF">apply</span><span style="color:#79B8FF"> my-</span><span style="color:#E1E4E8">8;</span></span>
<span class="line"><span style="color:#79B8FF">  border-color</span><span style="color:#E1E4E8">: </span><span style="color:#79B8FF">var</span><span style="color:#E1E4E8">(</span><span style="color:#FFAB70">--color-border</span><span style="color:#E1E4E8">); </span><span style="color:#6A737D">/* 不能用 @apply border-default */</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span></code></pre>
<p><strong>關鍵差異：</strong></p>
<ul>
<li>❌ <strong>不能用</strong> <code>@apply text-default</code>（自訂 utility）</li>
<li>✅ <strong>可以用</strong> <code>@apply text-base</code>（TailwindCSS 內建 utility）</li>
<li>✅ <strong>可以用</strong> <code>@apply bg-primary-500</code>（<code>@theme</code> 定義的顏色）</li>
<li>✅ <strong>改用</strong> <code>color: var(--color-default)</code>（直接使用 CSS 變數）</li>
</ul>
<h4 id="3-更新引入順序">3. 更新引入順序</h4>
<p><strong>BaseHead.astro：</strong></p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="astro"><code><span class="line"><span style="color:#6A737D">---</span></span>
<span class="line"><span style="color:#F97583">import</span><span style="color:#9ECBFF"> '../styles/tailwind.css'</span><span style="color:#E1E4E8">;  </span><span style="color:#6A737D">// 先載入 TailwindCSS</span></span>
<span class="line"><span style="color:#F97583">import</span><span style="color:#9ECBFF"> '../styles/global.css'</span><span style="color:#E1E4E8">;     </span><span style="color:#6A737D">// 後載入全域樣式（已改為 .css）</span></span>
<span class="line"><span style="color:#6A737D">---</span></span></code></pre>
<h2 id="第三階段處理組件中的-apply">第三階段：處理組件中的 @apply</h2>
<h3 id="問題組件中的-apply-報錯">問題：組件中的 @apply 報錯</h3>
<p>在 Astro 組件的 <code>&#x3C;style></code> 標籤中使用 <code>@apply</code> 時，會出現錯誤：</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>Cannot apply unknown utility class `lg:translate-x-0`.</span></span>
<span class="line"><span>Are you using CSS modules or similar and missing `@reference`?</span></span></code></pre>
<h3 id="解決方案使用-reference-指令">解決方案：使用 @reference 指令</h3>
<p>好消息！<strong>組件中的 <code>&#x3C;style></code> 標籤仍可使用 SCSS</strong>，只需加上 <code>@reference</code>：</p>
<p><strong>Header.astro：</strong></p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="astro"><code><span class="line"><span style="color:#E1E4E8">&#x3C;</span><span style="color:#85E89D">style</span><span style="color:#B392F0"> is:global</span><span style="color:#B392F0"> lang</span><span style="color:#E1E4E8">=</span><span style="color:#9ECBFF">"scss"</span><span style="color:#E1E4E8">></span></span>
<span class="line"><span style="color:#E1E4E8">  @reference "../styles/tailwind.css";</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0">  .nav-toggle:checked</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#85E89D">    &#x26;</span><span style="color:#E1E4E8"> ~ </span><span style="color:#85E89D">header</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#B392F0">      #hamburger</span><span style="color:#E1E4E8"> > </span><span style="color:#85E89D">span</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#E1E4E8">        @</span><span style="color:#79B8FF">apply</span><span style="color:#85E89D"> rotate-180</span><span style="color:#79B8FF"> bg-transparent</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#E1E4E8">        @</span><span style="color:#79B8FF">apply</span><span style="color:#79B8FF"> before</span><span style="color:#E1E4E8">:translate</span><span style="color:#79B8FF">-</span><span style="color:#E1E4E8">y</span><span style="color:#79B8FF">-</span><span style="color:#E1E4E8">2.</span><span style="color:#79B8FF">5</span><span style="color:#79B8FF"> before</span><span style="color:#E1E4E8">:rotate</span><span style="color:#79B8FF">-</span><span style="color:#E1E4E8">45;</span></span>
<span class="line"><span style="color:#E1E4E8">        @</span><span style="color:#79B8FF">apply</span><span style="color:#79B8FF"> after</span><span style="color:#E1E4E8">:</span><span style="color:#F97583">-</span><span style="color:#E1E4E8">translate</span><span style="color:#79B8FF">-</span><span style="color:#E1E4E8">y</span><span style="color:#79B8FF">-</span><span style="color:#E1E4E8">2.</span><span style="color:#79B8FF">5</span><span style="color:#79B8FF"> after</span><span style="color:#E1E4E8">:</span><span style="color:#F97583">-</span><span style="color:#E1E4E8">rotate</span><span style="color:#79B8FF">-</span><span style="color:#E1E4E8">45;</span></span>
<span class="line"><span style="color:#E1E4E8">      }</span></span>
<span class="line"><span style="color:#E1E4E8">      > </span><span style="color:#85E89D">div</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#E1E4E8">        @</span><span style="color:#79B8FF">apply</span><span style="color:#79B8FF"> -translate-x-</span><span style="color:#E1E4E8">80 </span><span style="color:#79B8FF">lg</span><span style="color:#E1E4E8">:translate</span><span style="color:#79B8FF">-</span><span style="color:#E1E4E8">x</span><span style="color:#79B8FF">-</span><span style="color:#E1E4E8">0;</span></span>
<span class="line"><span style="color:#E1E4E8">      }</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"><span style="color:#E1E4E8">  }</span></span>
<span class="line"><span style="color:#E1E4E8">&#x3C;/</span><span style="color:#85E89D">style</span><span style="color:#E1E4E8">></span></span></code></pre>
<p><strong>為什麼需要 @reference？</strong></p>
<ul>
<li>Astro 的 <code>&#x3C;style></code> 標籤會被獨立處理成 CSS 模組</li>
<li>TailwindCSS 編譯器無法看到其他檔案中的 utility classes 定義</li>
<li><code>@reference</code> 告訴 TailwindCSS：「去 <code>tailwind.css</code> 找 utility classes 的定義」</li>
<li><strong>不會重複載入</strong>，只是提供參考路徑</li>
<li><strong>仍可使用 Sass 語法</strong>（如 <code>&#x26;</code> 巢狀）</li>
</ul>
<p><strong>重要：</strong> 組件中的 SCSS 是安全的，因為 Astro 會先用 Sass 編譯，再交給 TailwindCSS 處理。只有<strong>獨立的 <code>.scss</code> 檔案搭配 <code>@import "tailwindcss"</code></strong> 才會有問題</p>
<h2 id="第四階段避免-sass-棄用警告">第四階段：避免 Sass 棄用警告</h2>
<h3 id="問題sass-import-棄用警告">問題：Sass @import 棄用警告</h3>
<p>如果在 <code>.scss</code> 檔案中使用 <code>@import "tailwindcss"</code>，會看到：</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>Deprecation Warning [import]: Sass @import rules are deprecated</span></span>
<span class="line"><span>and will be removed in Dart Sass 3.0.0.</span></span></code></pre>
<h3 id="最終解決方案改用純-css">最終解決方案：改用純 CSS</h3>
<p>將主樣式表從 <code>global.scss</code> 改為 <code>global.css</code> 後，這個警告完全消失了！</p>
<p><strong>為什麼？</strong></p>
<ul>
<li><code>global.css</code> 是純 CSS，不經過 Sass 預處理器</li>
<li><code>@import "./tailwind.css"</code> 是標準 CSS @import，不會觸發 Sass 警告</li>
<li>TailwindCSS v4 的 Vite plugin 會正確處理 CSS @import</li>
</ul>
<h3 id="組件中的-scss-仍可使用">組件中的 SCSS 仍可使用</h3>
<p><strong>關鍵理解：</strong></p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>✅ 組件 &#x3C;style lang="scss"> + @reference     → 安全，可用 SCSS</span></span>
<span class="line"><span>❌ 獨立 .scss 檔案 + @import "tailwindcss"   → 警告，避免使用</span></span>
<span class="line"><span>✅ 獨立 .css 檔案 + @import "tailwindcss"    → 安全，推薦使用</span></span></code></pre>
<p>這就是為什麼我們最終將 <code>global.scss</code> 改為 <code>global.css</code>，但組件中仍保留 <code>lang="scss"</code></p>
<h2 id="關鍵知識點總結">關鍵知識點總結</h2>
<h3 id="1-tailwindcss-v4-不支援-sass-預處理器">1. TailwindCSS v4 不支援 Sass 預處理器</h3>
<p><strong>v3 的做法（已不適用）：</strong></p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="scss"><code><span class="line"><span style="color:#F97583">@import</span><span style="color:#9ECBFF"> "tailwindcss"</span><span style="color:#E1E4E8">; </span><span style="color:#6A737D">// Sass 會預處理這行</span></span>
<span class="line"><span style="color:#E1E4E8">@theme { ... }         </span><span style="color:#6A737D">// 元數據會被破壞</span></span></code></pre>
<p><strong>v4 的做法：</strong></p>
<ul>
<li>將 <code>@import "tailwindcss"</code> 和 <code>@theme</code> 放在<strong>純 CSS 檔案</strong>（<code>tailwind.css</code>）</li>
<li>主樣式表也改用純 CSS（<code>global.css</code>）</li>
<li>SCSS 只用於組件的 <code>&#x3C;style></code> 標籤</li>
</ul>
<h3 id="2-apply-的限制">2. @apply 的限制</h3>
<p><strong>在 global.css 中：</strong></p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="css"><code><span class="line"><span style="color:#6A737D">/* ✅ 可以 @apply TailwindCSS 內建 utilities */</span></span>
<span class="line"><span style="color:#B392F0">.post</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#E1E4E8">  @</span><span style="color:#79B8FF">apply</span><span style="color:#79B8FF"> text-base</span><span style="color:#79B8FF"> my-</span><span style="color:#E1E4E8">4;</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D">/* ✅ 可以 @apply @theme 定義的顏色 */</span></span>
<span class="line"><span style="color:#B392F0">.btn</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#E1E4E8">  @</span><span style="color:#79B8FF">apply</span><span style="color:#79B8FF"> bg-primary-</span><span style="color:#E1E4E8">500 </span><span style="color:#79B8FF">text-white</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D">/* ❌ 不能 @apply 自訂 utilities */</span></span>
<span class="line"><span style="color:#B392F0">.post</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#E1E4E8">  @</span><span style="color:#79B8FF">apply</span><span style="color:#79B8FF"> text-default</span><span style="color:#E1E4E8">;  </span><span style="color:#6A737D">/* 會報錯 */</span></span>
<span class="line"><span style="color:#79B8FF">  color</span><span style="color:#E1E4E8">: </span><span style="color:#79B8FF">var</span><span style="color:#E1E4E8">(</span><span style="color:#FFAB70">--color-default</span><span style="color:#E1E4E8">);  </span><span style="color:#6A737D">/* 改用這個 */</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span></code></pre>
<h3 id="3-reference-的作用">3. @reference 的作用</h3>
<ul>
<li><strong>不是載入檔案</strong>，而是告訴編譯器「去哪裡找定義」</li>
<li>只在組件的 <code>&#x3C;style></code> 標籤中需要</li>
<li>不會增加輸出檔案大小</li>
<li><strong>允許組件繼續使用 SCSS 語法</strong></li>
</ul>
<h3 id="4-正確的檔案組織">4. 正確的檔案組織</h3>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>src/styles/</span></span>
<span class="line"><span>├── tailwind.css      # TailwindCSS 配置（純 CSS + @theme）</span></span>
<span class="line"><span>└── global.css        # 全域樣式（純 CSS + @apply）</span></span>
<span class="line"><span></span></span>
<span class="line"><span>src/components/</span></span>
<span class="line"><span>└── Header.astro      # &#x3C;style lang="scss"> + @reference</span></span></code></pre>
<h3 id="5-字體定義的陷阱">5. 字體定義的陷阱</h3>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="css"><code><span class="line"><span style="color:#6A737D">/* ❌ 錯誤 - 無法生成 font-dosis utility */</span></span>
<span class="line"><span style="color:#F97583">@theme</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#E1E4E8">  --font-family-dosis: "Dosis", </span><span style="color:#85E89D">sans-serif</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D">/* ✅ 正確 - 可生成 font-dosis utility */</span></span>
<span class="line"><span style="color:#F97583">@theme</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#E1E4E8">  --font-dosis: "Dosis", </span><span style="color:#85E89D">sans-serif</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span></code></pre>
<h2 id="完整的最佳實踐">完整的最佳實踐</h2>
<h3 id="1-tailwindcsstailwindcss-配置">1. tailwind.css（TailwindCSS 配置）</h3>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="css"><code><span class="line"><span style="color:#6A737D">/* src/styles/tailwind.css */</span></span>
<span class="line"><span style="color:#F97583">@import</span><span style="color:#9ECBFF"> "tailwindcss"</span><span style="color:#E1E4E8">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">@theme</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#6A737D">  /* 字體 - 注意：--font-* 而非 --font-family-* */</span></span>
<span class="line"><span style="color:#E1E4E8">  --font-dosis: "Dosis", </span><span style="color:#85E89D">sans-serif</span><span style="color:#E1E4E8">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D">  /* 顏色 */</span></span>
<span class="line"><span style="color:#E1E4E8">  --color-primary-500: </span><span style="color:#FDAEB7;font-style:italic">#00aaaa</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#E1E4E8">  --color-primary-700: </span><span style="color:#FDAEB7;font-style:italic">#009999</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span></code></pre>
<h3 id="2-globalcss全域樣式---已改為純-css">2. global.css（全域樣式 - 已改為純 CSS）</h3>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="css"><code><span class="line"><span style="color:#6A737D">/* src/styles/global.css */</span></span>
<span class="line"><span style="color:#F97583">@import</span><span style="color:#79B8FF"> url</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">"https://fonts.googleapis.com/css?family=Dosis:300,400,500,600,700"</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#F97583">@import</span><span style="color:#9ECBFF"> "./tailwind.css"</span><span style="color:#E1E4E8">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">@layer</span><span style="color:#E1E4E8"> base {</span></span>
<span class="line"><span style="color:#B392F0">  :root</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#6A737D">    /* 自訂 CSS 變數 */</span></span>
<span class="line"><span style="color:#FFAB70">    --color-default</span><span style="color:#E1E4E8">: </span><span style="color:#79B8FF">#444</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#FFAB70">    --color-background</span><span style="color:#E1E4E8">: </span><span style="color:#79B8FF">#fff</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#E1E4E8">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0">  :root.dark</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#FFAB70">    --color-default</span><span style="color:#E1E4E8">: </span><span style="color:#79B8FF">#fff</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#FFAB70">    --color-background</span><span style="color:#E1E4E8">: </span><span style="color:#79B8FF">#1c1c1c</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#E1E4E8">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#85E89D">  html</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#E1E4E8">    @</span><span style="color:#79B8FF">apply</span><span style="color:#79B8FF"> relative</span><span style="color:#79B8FF"> m-</span><span style="color:#E1E4E8">0 </span><span style="color:#79B8FF">h-full</span><span style="color:#79B8FF"> w-full</span><span style="color:#79B8FF"> p-</span><span style="color:#E1E4E8">0;</span></span>
<span class="line"><span style="color:#E1E4E8">  }</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D">/* 自訂 utilities - 放在 @layer 外面 */</span></span>
<span class="line"><span style="color:#B392F0">.text-default</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#79B8FF">  color</span><span style="color:#E1E4E8">: </span><span style="color:#79B8FF">var</span><span style="color:#E1E4E8">(</span><span style="color:#FFAB70">--color-default</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D">/* Blog 樣式 - 混用 @apply 和 CSS 變數 */</span></span>
<span class="line"><span style="color:#B392F0">.post</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#E1E4E8">  @</span><span style="color:#79B8FF">apply</span><span style="color:#79B8FF"> text-base</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#79B8FF">  color</span><span style="color:#E1E4E8">: </span><span style="color:#79B8FF">var</span><span style="color:#E1E4E8">(</span><span style="color:#FFAB70">--color-default</span><span style="color:#E1E4E8">);  </span><span style="color:#6A737D">/* 不能用 @apply text-default */</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0">.post</span><span style="color:#85E89D"> h1</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#E1E4E8">  @</span><span style="color:#79B8FF">apply</span><span style="color:#79B8FF"> my-</span><span style="color:#E1E4E8">4 </span><span style="color:#79B8FF">text-</span><span style="color:#E1E4E8">3</span><span style="color:#79B8FF">xl</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#79B8FF">  color</span><span style="color:#E1E4E8">: </span><span style="color:#79B8FF">var</span><span style="color:#E1E4E8">(</span><span style="color:#FFAB70">--color-default</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0">.btn</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#E1E4E8">  @</span><span style="color:#79B8FF">apply</span><span style="color:#79B8FF"> bg-primary-</span><span style="color:#E1E4E8">500 </span><span style="color:#79B8FF">text-white</span><span style="color:#E1E4E8">;  </span><span style="color:#6A737D">/* 可以用 @theme 的顏色 */</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span></code></pre>
<p><strong>重點：</strong></p>
<ul>
<li>✅ 外層 <code>@import</code> 放在最前面</li>
<li>✅ 自訂 utilities 定義在 <code>@layer</code> 外面（供 HTML 使用）</li>
<li>✅ <code>@apply</code> 只用於 TailwindCSS 內建或 <code>@theme</code> 定義的 utilities</li>
<li>✅ 自訂 utilities 改用 <code>color: var(--...)</code> 等 CSS 變數</li>
</ul>
<h3 id="3-baseheadastro入口">3. BaseHead.astro（入口）</h3>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="astro"><code><span class="line"><span style="color:#6A737D">---</span></span>
<span class="line"><span style="color:#F97583">import</span><span style="color:#9ECBFF"> '../styles/tailwind.css'</span><span style="color:#E1E4E8">;  </span><span style="color:#6A737D">// 先載入 TailwindCSS</span></span>
<span class="line"><span style="color:#F97583">import</span><span style="color:#9ECBFF"> '../styles/global.css'</span><span style="color:#E1E4E8">;     </span><span style="color:#6A737D">// 後載入全域樣式（已改為 .css）</span></span>
<span class="line"><span style="color:#6A737D">---</span></span></code></pre>
<h3 id="4-組件中使用-apply可繼續用-scss">4. 組件中使用 @apply（可繼續用 SCSS）</h3>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="astro"><code><span class="line"><span style="color:#6A737D">&#x3C;!-- Header.astro --></span></span>
<span class="line"><span style="color:#E1E4E8">&#x3C;</span><span style="color:#85E89D">style</span><span style="color:#B392F0"> is:global</span><span style="color:#B392F0"> lang</span><span style="color:#E1E4E8">=</span><span style="color:#9ECBFF">"scss"</span><span style="color:#E1E4E8">></span></span>
<span class="line"><span style="color:#E1E4E8">  @reference "../styles/tailwind.css";</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0">  .nav-toggle:checked</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#85E89D">    &#x26;</span><span style="color:#E1E4E8"> ~ </span><span style="color:#85E89D">header</span><span style="color:#E1E4E8"> {  </span><span style="color:#6A737D">/* 仍可使用 Sass 巢狀 */</span></span>
<span class="line"><span style="color:#E1E4E8">      > </span><span style="color:#85E89D">div</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#E1E4E8">        @</span><span style="color:#79B8FF">apply</span><span style="color:#79B8FF"> -translate-x-</span><span style="color:#E1E4E8">80 </span><span style="color:#79B8FF">lg</span><span style="color:#E1E4E8">:translate</span><span style="color:#79B8FF">-</span><span style="color:#E1E4E8">x</span><span style="color:#79B8FF">-</span><span style="color:#E1E4E8">0;</span></span>
<span class="line"><span style="color:#E1E4E8">      }</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"><span style="color:#E1E4E8">  }</span></span>
<span class="line"><span style="color:#E1E4E8">&#x3C;/</span><span style="color:#85E89D">style</span><span style="color:#E1E4E8">></span></span></code></pre>
<p><strong>組件中的優勢：</strong></p>
<ul>
<li>✅ 可繼續使用 <code>lang="scss"</code></li>
<li>✅ 支援 Sass 巢狀語法（<code>&#x26;</code>、<code>></code>）</li>
<li>✅ 使用 <code>@reference</code> 即可 <code>@apply</code></li>
<li>✅ 不會有 Sass 棄用警告</li>
</ul>
<h2 id="驗證升級成功">驗證升級成功</h2>
<h3 id="1-建置測試">1. 建置測試</h3>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="bash"><code><span class="line"><span style="color:#B392F0">npm</span><span style="color:#9ECBFF"> run</span><span style="color:#9ECBFF"> build</span></span></code></pre>
<p>應該看到：</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>18:48:17 [build] 263 page(s) built in 6.29s</span></span>
<span class="line"><span>18:48:17 [build] Complete!</span></span></code></pre>
<p>沒有任何 Sass 棄用警告！</p>
<h3 id="2-檢查顏色是否正常">2. 檢查顏色是否正常</h3>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="bash"><code><span class="line"><span style="color:#B392F0">npm</span><span style="color:#9ECBFF"> run</span><span style="color:#9ECBFF"> preview</span></span>
<span class="line"><span style="color:#6A737D"># 或</span></span>
<span class="line"><span style="color:#B392F0">npm</span><span style="color:#9ECBFF"> run</span><span style="color:#9ECBFF"> dev</span></span></code></pre>
<p>打開瀏覽器檢查：</p>
<ul>
<li>✅ Primary 顏色（青色）正常顯示</li>
<li>✅ Blog 文章樣式正確</li>
<li>✅ 暗黑模式切換正常</li>
<li>✅ 自訂字體載入成功</li>
</ul>
<h3 id="3-檢查-css-輸出可選">3. 檢查 CSS 輸出（可選）</h3>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="bash"><code><span class="line"><span style="color:#6A737D"># 檢查 primary 顏色變數</span></span>
<span class="line"><span style="color:#B392F0">cat</span><span style="color:#9ECBFF"> dist/_astro/</span><span style="color:#79B8FF">*</span><span style="color:#9ECBFF">.css</span><span style="color:#F97583"> |</span><span style="color:#B392F0"> grep</span><span style="color:#9ECBFF"> "color-primary-500"</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D"># 檢查字體定義</span></span>
<span class="line"><span style="color:#B392F0">cat</span><span style="color:#9ECBFF"> dist/_astro/</span><span style="color:#79B8FF">*</span><span style="color:#9ECBFF">.css</span><span style="color:#F97583"> |</span><span style="color:#B392F0"> grep</span><span style="color:#9ECBFF"> "font-dosis"</span></span></code></pre>
<h2 id="常見問題-faq">常見問題 FAQ</h2>
<h3 id="q1-為什麼不能在-globalscss-中使用-theme">Q1: 為什麼不能在 global.scss 中使用 @theme？</h3>
<p><strong>A:</strong> Sass 預處理器會破壞 TailwindCSS 的元數據，導致自訂顏色的 utility classes 無法生成。必須將 <code>@theme</code> 放在純 CSS 檔案（<code>tailwind.css</code>）中。</p>
<h3 id="q2-一定要把-globalscss-改成-globalcss-嗎">Q2: 一定要把 global.scss 改成 global.css 嗎？</h3>
<p><strong>A:</strong> 是的。獨立的 <code>.scss</code> 檔案使用 <code>@import "tailwindcss"</code> 會觸發 Sass 棄用警告，且在 <code>@apply</code> 自訂 utilities 時會失敗。改為 <code>.css</code> 後這些問題都解決了。</p>
<h3 id="q3-改成-globalcss-後還能用-sass-語法嗎">Q3: 改成 global.css 後還能用 Sass 語法嗎？</h3>
<p><strong>A:</strong> 主樣式表不行，但<strong>組件中可以</strong>！在組件的 <code>&#x3C;style lang="scss"></code> 中加上 <code>@reference</code>，就能繼續使用 Sass 巢狀語法和 <code>@apply</code>。</p>
<h3 id="q4-reference-會重複載入-tailwindcss-嗎">Q4: @reference 會重複載入 TailwindCSS 嗎？</h3>
<p><strong>A:</strong> 不會。<code>@reference</code> 只是告訴編譯器去哪裡找定義，不會實際載入檔案內容。最終只會輸出一份 TailwindCSS。</p>
<h3 id="q5-為什麼-apply-text-default-會報錯">Q5: 為什麼 @apply text-default 會報錯？</h3>
<p><strong>A:</strong> TailwindCSS v4 的 <code>@apply</code> 只能使用：</p>
<ul>
<li>✅ TailwindCSS 內建 utilities（<code>text-base</code>、<code>flex</code> 等）</li>
<li>✅ <code>@theme</code> 定義的顏色（<code>bg-primary-500</code>）</li>
<li>❌ 自訂的 CSS classes（<code>text-default</code>、<code>bg-light</code>）</li>
</ul>
<p>解決方法：將 <code>@apply text-default</code> 改為 <code>color: var(--color-default)</code>。</p>
<h3 id="q6-font-dosis-utility-為什麼無法生成">Q6: font-dosis utility 為什麼無法生成？</h3>
<p><strong>A:</strong> TailwindCSS v4 字體定義必須使用 <code>--font-*</code> 格式：</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="css"><code><span class="line"><span style="color:#6A737D">/* ❌ 錯誤 */</span></span>
<span class="line"><span style="color:#E1E4E8">--font-family-dosis: "Dosis", </span><span style="color:#85E89D">sans-serif</span><span style="color:#E1E4E8">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D">/* ✅ 正確 */</span></span>
<span class="line"><span style="color:#E1E4E8">--font-dosis: "Dosis", </span><span style="color:#85E89D">sans-serif</span><span style="color:#E1E4E8">;</span></span></code></pre>
<h3 id="q7-一定要用-tailwindcssvite-嗎">Q7: 一定要用 @tailwindcss/vite 嗎？</h3>
<p><strong>A:</strong> 是的。TailwindCSS v4 不再支援舊的 <code>@astrojs/tailwind</code> integration，必須使用 Vite plugin。</p>
<h2 id="升級效益">升級效益</h2>
<p>✅ <strong>使用最新的 TailwindCSS v4 特性</strong>
✅ <strong>CSS-first 配置更直觀</strong>
✅ <strong>保留 SCSS 的便利性</strong>
✅ <strong>@reference 避免重複載入</strong>
✅ <strong>更好的 Vite 整合</strong></p>
<h2 id="升級後的檔案結構總覽">升級後的檔案結構總覽</h2>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>src/</span></span>
<span class="line"><span>├── styles/</span></span>
<span class="line"><span>│   ├── tailwind.css       # TailwindCSS 配置（純 CSS）</span></span>
<span class="line"><span>│   │                       # - @import "tailwindcss"</span></span>
<span class="line"><span>│   │                       # - @theme { 自訂顏色、字體 }</span></span>
<span class="line"><span>│   │</span></span>
<span class="line"><span>│   └── global.css         # 全域樣式（純 CSS）</span></span>
<span class="line"><span>│                           # - @import "./tailwind.css"</span></span>
<span class="line"><span>│                           # - @layer base { ... }</span></span>
<span class="line"><span>│                           # - 自訂 utilities</span></span>
<span class="line"><span>│                           # - .post 等樣式</span></span>
<span class="line"><span>│</span></span>
<span class="line"><span>├── components/</span></span>
<span class="line"><span>│   ├── BaseHead.astro     # import '../styles/tailwind.css'</span></span>
<span class="line"><span>│   │                       # import '../styles/global.css'</span></span>
<span class="line"><span>│   │</span></span>
<span class="line"><span>│   └── Header.astro       # &#x3C;style lang="scss" is:global></span></span>
<span class="line"><span>│                           #   @reference "../styles/tailwind.css"</span></span>
<span class="line"><span>│                           #   仍可使用 Sass 巢狀語法</span></span>
<span class="line"><span>│</span></span>
<span class="line"><span>└── layouts/</span></span>
<span class="line"><span>    └── ContentLayout.astro # &#x3C;style lang="scss" is:global></span></span>
<span class="line"><span>                             #   @reference "../styles/tailwind.css"</span></span></code></pre>
<h2 id="結語">結語</h2>
<p>TailwindCSS v4 的升級看似簡單，但與 Sass 的相容性問題容易讓人卡關數小時。關鍵是理解：</p>
<ol>
<li><strong>TailwindCSS v4 不支援 Sass 預處理 <code>@theme</code></strong> → 必須放在純 CSS 檔案</li>
<li><strong>獨立樣式表改用純 CSS</strong> → 避免 Sass 警告和 <code>@apply</code> 問題</li>
<li><strong>組件仍可用 SCSS + @reference</strong> → 保留巢狀語法的便利性</li>
<li><strong>@apply 只能用 TailwindCSS/<code>@theme</code> 的 utilities</strong> → 自訂的改用 CSS 變數</li>
<li><strong>字體定義用 <code>--font-*</code></strong> → 才能生成對應 utility class</li>
</ol>
<p>經過這次升級，我深刻體會到 TailwindCSS v4 的 <strong>CSS-first</strong> 哲學：配置回歸 CSS，減少對預處理器的依賴。雖然過程曲折，但最終的架構更清晰、更符合現代標準。</p>
<p>希望這篇文章能幫助你順利完成升級，避免踩到相同的坑！如果有任何問題，歡迎在下方留言討論。</p>
<h2 id="參考資源">參考資源</h2>
<ul>
<li><a href="https://tailwindcss.com/docs">TailwindCSS v4 官方文件</a></li>
<li><a href="https://tailwindcss.com/docs/upgrade-guide">TailwindCSS v4 升級指南</a></li>
<li><a href="https://tailwindcss.com/docs/functions-and-directives#reference-directive">@reference 指令說明</a></li>
<li><a href="https://docs.astro.build/en/guides/styling/">Astro 整合 TailwindCSS</a></li>
</ul> </div> </div> <div class="border-b border-default"> <div class="flex justify-between"> <a href="/blog/life/2024_status" class="px-4 flex h-12 cursor-pointer items-center justify-center border-r border-default hover:bg-border"> <svg width="1em" height="1em" viewBox="0 0 15 15" class="mr-4 h-4 w-4" data-icon="teenyicons:left-outline">  <symbol id="ai:teenyicons:left-outline"><path fill="none" stroke="currentColor" stroke-linecap="square" d="M10 14L3 7.5L10 1"/></symbol><use  xlink:href="#ai:teenyicons:left-outline"></use>  </svg> 2024 近況 </a> <a href="/blog/astro/astro_v5_upgrade" class="px-4 flex h-12 cursor-pointer items-center justify-center border-l border-default hover:bg-border"> Astro 5.x 升級實戰：從 4.10 到 5.14 的完整遷移指南 <svg width="1em" height="1em" viewBox="0 0 15 15" class="ml-4 h-4 w-4" data-icon="teenyicons:right-outline">  <symbol id="ai:teenyicons:right-outline"><path fill="none" stroke="currentColor" stroke-linecap="square" d="m5 14l7-6.5L5 1"/></symbol><use  xlink:href="#ai:teenyicons:right-outline"></use>  </svg> </a> </div> </div> <div class="py-[3.35rem] px-[4vw]"> <!-- <hr class="my-8 text-gray-200" /> --><p class="text-lg">對這篇文章有什麼想法嗎?</p> <div id="blog-comments"></div> <script type="module">const e=localStorage.getItem("theme"),r=e==="light"?"github-light":"github-dark",t=document.createElement("script");t.type="text/javascript";t.src="https://utteranc.es/client.js";t.setAttribute("repo","mtwmt/mtwmt.github.io");t.setAttribute("issue-term","pathname");t.setAttribute("theme",r);t.setAttribute("crossorigin","anonymous");document.querySelector("#blog-comments")?.appendChild(t);</script> </div>   <footer class="animation relative bg-default lg:transition-none"> <div> <p class="p-4 text-right text-xs">
Copyright © 2025 Mandy. All rights reserved. Build with Astro
</p> </div> </footer> </article> <aside class="animation absolute -top-[152px] right-0 z-0 min-h-full w-80 origin-[center_right] bg-primary-800 scale-90 
  lg:scale-100
  lg:relative lg:top-0 lg:float-right lg:transition-none">  <ul data-blog-toc class="leading-[3rem] sticky top-0"><li class="h-12 border-b border-primary-700 bg-primary-900 px-3 text-primary-50">
文章導覽
</li><li class="h-12 border-b border-primary-700 text-primary-50 hover:bg-primary-700 hover:text-white"><a class="block w-full cursor-pointer px-3 " href="#前言" aria-label="Scroll to section: 前言">前言</a></li><li class="h-12 border-b border-primary-700 text-primary-50 hover:bg-primary-700 hover:text-white"><a class="block w-full cursor-pointer px-3 " href="#升級概述" aria-label="Scroll to section: 升級概述">升級概述</a></li><li class="h-12 border-b border-primary-700 text-primary-50 hover:bg-primary-700 hover:text-white"><a class="block w-full cursor-pointer px-3 " href="#第一階段基本升級" aria-label="Scroll to section: 第一階段：基本升級">第一階段：基本升級</a></li><li class="h-12 border-b border-primary-700 text-primary-50 hover:bg-primary-700 hover:text-white"><a class="block w-full cursor-pointer px-3 indent-4" href="#1-安裝新版本" aria-label="Scroll to section: 1. 安裝新版本">1. 安裝新版本</a></li><li class="h-12 border-b border-primary-700 text-primary-50 hover:bg-primary-700 hover:text-white"><a class="block w-full cursor-pointer px-3 indent-4" href="#2-更新-astro-配置" aria-label="Scroll to section: 2. 更新 Astro 配置">2. 更新 Astro 配置</a></li><li class="h-12 border-b border-primary-700 text-primary-50 hover:bg-primary-700 hover:text-white"><a class="block w-full cursor-pointer px-3 indent-4" href="#3-刪除舊配置" aria-label="Scroll to section: 3. 刪除舊配置">3. 刪除舊配置</a></li><li class="h-12 border-b border-primary-700 text-primary-50 hover:bg-primary-700 hover:text-white"><a class="block w-full cursor-pointer px-3 " href="#第二階段處理-sass-衝突" aria-label="Scroll to section: 第二階段：處理 Sass 衝突">第二階段：處理 Sass 衝突</a></li><li class="h-12 border-b border-primary-700 text-primary-50 hover:bg-primary-700 hover:text-white"><a class="block w-full cursor-pointer px-3 indent-4" href="#問題自訂顏色完全消失" aria-label="Scroll to section: 問題：自訂顏色完全消失">問題：自訂顏色完全消失</a></li><li class="h-12 border-b border-primary-700 text-primary-50 hover:bg-primary-700 hover:text-white"><a class="block w-full cursor-pointer px-3 indent-4" href="#解決方案完全改用純-css" aria-label="Scroll to section: 解決方案：完全改用純 CSS">解決方案：完全改用純 CSS</a></li><li class="h-12 border-b border-primary-700 text-primary-50 hover:bg-primary-700 hover:text-white"><a class="block w-full cursor-pointer px-3 indent-6" href="#1-建立-tailwindcss" aria-label="Scroll to section: 1. 建立 tailwind.css">1. 建立 tailwind.css</a></li><li class="h-12 border-b border-primary-700 text-primary-50 hover:bg-primary-700 hover:text-white"><a class="block w-full cursor-pointer px-3 indent-6" href="#2-將-globalscss-轉換為-globalcss" aria-label="Scroll to section: 2. 將 global.scss 轉換為 global.css">2. 將 global.scss 轉換為 global.css</a></li><li class="h-12 border-b border-primary-700 text-primary-50 hover:bg-primary-700 hover:text-white"><a class="block w-full cursor-pointer px-3 indent-6" href="#3-更新引入順序" aria-label="Scroll to section: 3. 更新引入順序">3. 更新引入順序</a></li><li class="h-12 border-b border-primary-700 text-primary-50 hover:bg-primary-700 hover:text-white"><a class="block w-full cursor-pointer px-3 " href="#第三階段處理組件中的-apply" aria-label="Scroll to section: 第三階段：處理組件中的 @apply">第三階段：處理組件中的 @apply</a></li><li class="h-12 border-b border-primary-700 text-primary-50 hover:bg-primary-700 hover:text-white"><a class="block w-full cursor-pointer px-3 indent-4" href="#問題組件中的-apply-報錯" aria-label="Scroll to section: 問題：組件中的 @apply 報錯">問題：組件中的 @apply 報錯</a></li><li class="h-12 border-b border-primary-700 text-primary-50 hover:bg-primary-700 hover:text-white"><a class="block w-full cursor-pointer px-3 indent-4" href="#解決方案使用-reference-指令" aria-label="Scroll to section: 解決方案：使用 @reference 指令">解決方案：使用 @reference 指令</a></li><li class="h-12 border-b border-primary-700 text-primary-50 hover:bg-primary-700 hover:text-white"><a class="block w-full cursor-pointer px-3 " href="#第四階段避免-sass-棄用警告" aria-label="Scroll to section: 第四階段：避免 Sass 棄用警告">第四階段：避免 Sass 棄用警告</a></li><li class="h-12 border-b border-primary-700 text-primary-50 hover:bg-primary-700 hover:text-white"><a class="block w-full cursor-pointer px-3 indent-4" href="#問題sass-import-棄用警告" aria-label="Scroll to section: 問題：Sass @import 棄用警告">問題：Sass @import 棄用警告</a></li><li class="h-12 border-b border-primary-700 text-primary-50 hover:bg-primary-700 hover:text-white"><a class="block w-full cursor-pointer px-3 indent-4" href="#最終解決方案改用純-css" aria-label="Scroll to section: 最終解決方案：改用純 CSS">最終解決方案：改用純 CSS</a></li><li class="h-12 border-b border-primary-700 text-primary-50 hover:bg-primary-700 hover:text-white"><a class="block w-full cursor-pointer px-3 indent-4" href="#組件中的-scss-仍可使用" aria-label="Scroll to section: 組件中的 SCSS 仍可使用">組件中的 SCSS 仍可使用</a></li><li class="h-12 border-b border-primary-700 text-primary-50 hover:bg-primary-700 hover:text-white"><a class="block w-full cursor-pointer px-3 " href="#關鍵知識點總結" aria-label="Scroll to section: 關鍵知識點總結">關鍵知識點總結</a></li><li class="h-12 border-b border-primary-700 text-primary-50 hover:bg-primary-700 hover:text-white"><a class="block w-full cursor-pointer px-3 indent-4" href="#1-tailwindcss-v4-不支援-sass-預處理器" aria-label="Scroll to section: 1. TailwindCSS v4 不支援 Sass 預處理器">1. TailwindCSS v4 不支援 Sass 預處理器</a></li><li class="h-12 border-b border-primary-700 text-primary-50 hover:bg-primary-700 hover:text-white"><a class="block w-full cursor-pointer px-3 indent-4" href="#2-apply-的限制" aria-label="Scroll to section: 2. @apply 的限制">2. @apply 的限制</a></li><li class="h-12 border-b border-primary-700 text-primary-50 hover:bg-primary-700 hover:text-white"><a class="block w-full cursor-pointer px-3 indent-4" href="#3-reference-的作用" aria-label="Scroll to section: 3. @reference 的作用">3. @reference 的作用</a></li><li class="h-12 border-b border-primary-700 text-primary-50 hover:bg-primary-700 hover:text-white"><a class="block w-full cursor-pointer px-3 indent-4" href="#4-正確的檔案組織" aria-label="Scroll to section: 4. 正確的檔案組織">4. 正確的檔案組織</a></li><li class="h-12 border-b border-primary-700 text-primary-50 hover:bg-primary-700 hover:text-white"><a class="block w-full cursor-pointer px-3 indent-4" href="#5-字體定義的陷阱" aria-label="Scroll to section: 5. 字體定義的陷阱">5. 字體定義的陷阱</a></li><li class="h-12 border-b border-primary-700 text-primary-50 hover:bg-primary-700 hover:text-white"><a class="block w-full cursor-pointer px-3 " href="#完整的最佳實踐" aria-label="Scroll to section: 完整的最佳實踐">完整的最佳實踐</a></li><li class="h-12 border-b border-primary-700 text-primary-50 hover:bg-primary-700 hover:text-white"><a class="block w-full cursor-pointer px-3 indent-4" href="#1-tailwindcsstailwindcss-配置" aria-label="Scroll to section: 1. tailwind.css（TailwindCSS 配置）">1. tailwind.css（TailwindCSS 配置）</a></li><li class="h-12 border-b border-primary-700 text-primary-50 hover:bg-primary-700 hover:text-white"><a class="block w-full cursor-pointer px-3 indent-4" href="#2-globalcss全域樣式---已改為純-css" aria-label="Scroll to section: 2. global.css（全域樣式 - 已改為純 CSS）">2. global.css（全域樣式 - 已改為純 CSS）</a></li><li class="h-12 border-b border-primary-700 text-primary-50 hover:bg-primary-700 hover:text-white"><a class="block w-full cursor-pointer px-3 indent-4" href="#3-baseheadastro入口" aria-label="Scroll to section: 3. BaseHead.astro（入口）">3. BaseHead.astro（入口）</a></li><li class="h-12 border-b border-primary-700 text-primary-50 hover:bg-primary-700 hover:text-white"><a class="block w-full cursor-pointer px-3 indent-4" href="#4-組件中使用-apply可繼續用-scss" aria-label="Scroll to section: 4. 組件中使用 @apply（可繼續用 SCSS）">4. 組件中使用 @apply（可繼續用 SCSS）</a></li><li class="h-12 border-b border-primary-700 text-primary-50 hover:bg-primary-700 hover:text-white"><a class="block w-full cursor-pointer px-3 " href="#驗證升級成功" aria-label="Scroll to section: 驗證升級成功">驗證升級成功</a></li><li class="h-12 border-b border-primary-700 text-primary-50 hover:bg-primary-700 hover:text-white"><a class="block w-full cursor-pointer px-3 indent-4" href="#1-建置測試" aria-label="Scroll to section: 1. 建置測試">1. 建置測試</a></li><li class="h-12 border-b border-primary-700 text-primary-50 hover:bg-primary-700 hover:text-white"><a class="block w-full cursor-pointer px-3 indent-4" href="#2-檢查顏色是否正常" aria-label="Scroll to section: 2. 檢查顏色是否正常">2. 檢查顏色是否正常</a></li><li class="h-12 border-b border-primary-700 text-primary-50 hover:bg-primary-700 hover:text-white"><a class="block w-full cursor-pointer px-3 indent-4" href="#3-檢查-css-輸出可選" aria-label="Scroll to section: 3. 檢查 CSS 輸出（可選）">3. 檢查 CSS 輸出（可選）</a></li><li class="h-12 border-b border-primary-700 text-primary-50 hover:bg-primary-700 hover:text-white"><a class="block w-full cursor-pointer px-3 " href="#常見問題-faq" aria-label="Scroll to section: 常見問題 FAQ">常見問題 FAQ</a></li><li class="h-12 border-b border-primary-700 text-primary-50 hover:bg-primary-700 hover:text-white"><a class="block w-full cursor-pointer px-3 indent-4" href="#q1-為什麼不能在-globalscss-中使用-theme" aria-label="Scroll to section: Q1: 為什麼不能在 global.scss 中使用 @theme？">Q1: 為什麼不能在 global.scss 中使用 @theme？</a></li><li class="h-12 border-b border-primary-700 text-primary-50 hover:bg-primary-700 hover:text-white"><a class="block w-full cursor-pointer px-3 indent-4" href="#q2-一定要把-globalscss-改成-globalcss-嗎" aria-label="Scroll to section: Q2: 一定要把 global.scss 改成 global.css 嗎？">Q2: 一定要把 global.scss 改成 global.css 嗎？</a></li><li class="h-12 border-b border-primary-700 text-primary-50 hover:bg-primary-700 hover:text-white"><a class="block w-full cursor-pointer px-3 indent-4" href="#q3-改成-globalcss-後還能用-sass-語法嗎" aria-label="Scroll to section: Q3: 改成 global.css 後還能用 Sass 語法嗎？">Q3: 改成 global.css 後還能用 Sass 語法嗎？</a></li><li class="h-12 border-b border-primary-700 text-primary-50 hover:bg-primary-700 hover:text-white"><a class="block w-full cursor-pointer px-3 indent-4" href="#q4-reference-會重複載入-tailwindcss-嗎" aria-label="Scroll to section: Q4: @reference 會重複載入 TailwindCSS 嗎？">Q4: @reference 會重複載入 TailwindCSS 嗎？</a></li><li class="h-12 border-b border-primary-700 text-primary-50 hover:bg-primary-700 hover:text-white"><a class="block w-full cursor-pointer px-3 indent-4" href="#q5-為什麼-apply-text-default-會報錯" aria-label="Scroll to section: Q5: 為什麼 @apply text-default 會報錯？">Q5: 為什麼 @apply text-default 會報錯？</a></li><li class="h-12 border-b border-primary-700 text-primary-50 hover:bg-primary-700 hover:text-white"><a class="block w-full cursor-pointer px-3 indent-4" href="#q6-font-dosis-utility-為什麼無法生成" aria-label="Scroll to section: Q6: font-dosis utility 為什麼無法生成？">Q6: font-dosis utility 為什麼無法生成？</a></li><li class="h-12 border-b border-primary-700 text-primary-50 hover:bg-primary-700 hover:text-white"><a class="block w-full cursor-pointer px-3 indent-4" href="#q7-一定要用-tailwindcssvite-嗎" aria-label="Scroll to section: Q7: 一定要用 @tailwindcss/vite 嗎？">Q7: 一定要用 @tailwindcss/vite 嗎？</a></li><li class="h-12 border-b border-primary-700 text-primary-50 hover:bg-primary-700 hover:text-white"><a class="block w-full cursor-pointer px-3 " href="#升級效益" aria-label="Scroll to section: 升級效益">升級效益</a></li><li class="h-12 border-b border-primary-700 text-primary-50 hover:bg-primary-700 hover:text-white"><a class="block w-full cursor-pointer px-3 " href="#升級後的檔案結構總覽" aria-label="Scroll to section: 升級後的檔案結構總覽">升級後的檔案結構總覽</a></li><li class="h-12 border-b border-primary-700 text-primary-50 hover:bg-primary-700 hover:text-white"><a class="block w-full cursor-pointer px-3 " href="#結語" aria-label="Scroll to section: 結語">結語</a></li><li class="h-12 border-b border-primary-700 text-primary-50 hover:bg-primary-700 hover:text-white"><a class="block w-full cursor-pointer px-3 " href="#參考資源" aria-label="Scroll to section: 參考資源">參考資源</a></li></ul><script type="module">const n=e=>{for(let t of e){const{id:o}=t.target,r=document.querySelector(`[data-blog-toc] a[href="#${o}"]`);if(!r)return;t.isIntersecting&&(document.querySelectorAll("[data-blog-toc] a").forEach(c=>c.classList.remove("active")),r.classList.add("active"))}},s={root:null,rootMargin:"0px 0px -180px",threshold:1},a=new IntersectionObserver(n,s);document.querySelectorAll("article :is(h2,h3,h4)").forEach(e=>a.observe(e));</script><!-- https://www.fazzaamiarso.me/blog/toc-astro-spy/#create-the-component --><!-- <script>
    //---------------   Click Expand   ---------------
    let toggler = document.getElementsByClassName("toc_expand");
    for (let i = 0; i < toggler.length; i++) {
      toggler[i].addEventListener("click", function(e) {
        this.parentElement.parentElement.querySelector("ul")?.classList.toggle("hidden");
        this.parentElement.classList.toggle("expanded");
        e.preventDefault()
      });
    }


    //---------------   Scroll Spy   ---------------
    function escape_href(href){
        //the # bothers CSS.escape in case of id starting with a number
        return `#${CSS.escape(href.replace('#',''))}`
    }

    const article = document.querySelector( 'article.content' )
    const hrefs = document.getElementsByClassName("toc_href");
    const targets = [...hrefs].map(el => article.querySelector(escape_href(el.getAttribute('href'))))
    
    article.addEventListener("scroll", (event) => {
        let spy = null//if no element on screen, keep last match and do nothing
        for ( let t in targets ){//find first within visible scroll
            if(targets[ t ].offsetTop > article.scrollTop){
                spy = targets[ t ]
                break
            }
        }
        if(spy){
            document.querySelector(".toc_href.active")?.classList.remove("active");
            document.querySelector(".heading.active")?.classList.remove("active");
            const id = spy.id
            //console.log(id)
            document.querySelector(`a[href="#${id}"].toc_href`)?.classList.add("active")
            document.getElementById(id)?.classList.add("active")
        }
    })

    const href_els = document.querySelectorAll(".toc_href");
    href_els.forEach(element => {
        element.addEventListener('mouseenter',()=>{
            const href = element.getAttribute('href')
            const id = href.slice(1,href.length)
            document.getElementById(id)?.classList.add("hover")
        })        
        element.addEventListener('mouseout',()=>{
            const href = element.getAttribute('href')
            const id = href.slice(1,href.length)
            document.getElementById(id)?.classList.remove("hover")
        })        
    });
</script> -->  </aside> <!-- <aside class="animation scale-90 origin-[center_right] bg-primary-800 
  absolute w-[calc(20rem-1px)] top-12 right-0  overflow-hidden
  lg:relative lg:top-0 lg:float-right lg:scale-100  lg:transition-none lg:overflow-visible
  before:block before:fixed before:w-[1px] before:h-screen before:top-0 before:ml-[calc(20rem-2px)] before:bg-primary-800
  ">
  <slot />
</aside>

<style is:global lang="scss">
  .nav-toggle:checked {
    & ~ aside {
      @apply scale-100;
		}
  }
  
</style>
 --> </main>   </div> </body></html> <div data-gotop class="cursor-pointer fixed bottom-16 right-8 z-50 transition duration-300"> <svg width="1em" height="1em" viewBox="0 0 24 24" class="btn w-10 h-10 bg-white" data-icon="ic:outline-keyboard-arrow-up">  <symbol id="ai:ic:outline-keyboard-arrow-up"><path fill="currentColor" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6l-6 6z"/></symbol><use  xlink:href="#ai:ic:outline-keyboard-arrow-up"></use>  </svg> </div> <script type="module">const o=document.querySelector("[data-gotop]"),t=document.querySelector("header")?.offsetHeight||0,e=()=>{(window.scrollY||0)>t?(o?.classList.add("opacity-100"),o?.classList.remove("opacity-0")):(o?.classList.add("opacity-0"),o?.classList.remove("opacity-100"))};e();window.addEventListener("scroll",e);o?.addEventListener("click",function(){document.querySelector("html, body")?.scrollIntoView({behavior:"smooth",block:"start",inline:"nearest"})});</script> <script type="module">const n=document.querySelectorAll(".post");n.forEach(e=>{e.querySelectorAll("a").forEach(t=>{t.setAttribute("target","_blank")})});let c="Copy Code",l=Array.from(document.querySelectorAll("pre"));for(let e of l){let o=document.createElement("div");o.className="relative";let t=document.createElement("button");t.className="copy-code",t.innerHTML=c,e.setAttribute("tabindex","0"),e.appendChild(t),e.parentNode?.insertBefore(o,e),o.appendChild(e),t.addEventListener("click",async()=>{await a(e,t)})}async function a(e,o){let r=e.querySelector("code")?.innerText||"";await navigator.clipboard.writeText(r),o.innerText="Code Copied",setTimeout(()=>{o.innerText=c},700)}</script>