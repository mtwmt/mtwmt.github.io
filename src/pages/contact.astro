---
import Header from '../components/Header.astro';
import SearchWidget from '../components/SearchWidget.astro';
import { SITE_TITLE } from '../consts';
import AsideLayout from '../layouts/AsideLayout.astro';
import ContentLayout from '../layouts/ContentLayout.astro';
import MainLayout from '../layouts/MainLayout.astro';
import PageTitle from '../components/PageTitle.astro';
---

<MainLayout title={SITE_TITLE}>
  <Header />
  <ContentLayout>
    <PageTitle title="與我聯絡"></PageTitle>
    <div class="border-t border-default py-10 px-[4vw]">
      <form id="form">
        <div class="md:flex md:space-x-5">
          <div class="mt-3 md:w-1/2">
            <input
              type="text"
              name="name"
              class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-primary-300 focus:ring focus:ring-primary-200 focus:ring-opacity-50"
              placeholder="Your Name"
              required
            />
            <div id="nameError" class="error"></div>
          </div>
          <div class="mt-3 md:w-1/2">
            <input
              type="tel"
              name="tel"
              placeholder="Your Phone"
              class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-primary-300 focus:ring focus:ring-primary-200 focus:ring-opacity-50"
            />
          </div>
        </div>
        <div class="md:flex md:space-x-5">
          <div class="mt-3 md:w-1/2">
            <input
              type="email"
              name="email"
              id=""
              placeholder="Your Email"
              class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-primary-300 focus:ring focus:ring-primary-200 focus:ring-opacity-50"
              required
            />
            <div id="emailError" class="error"></div>
          </div>
          <div class="mt-3 md:w-1/2">
            <input
              type="text"
              name="line"
              id=""
              placeholder="Your LineID"
              class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-primary-300 focus:ring focus:ring-primary-200 focus:ring-opacity-50"
            />
          </div>
        </div>
        <div>
          <textarea
            name="message"
            id=""
            cols="10"
            rows="3"
            placeholder="想跟 Mandy 說些什麼？"
            class="resize-none mt-4 block w-full rounded-md border-gray-300 shadow-sm focus:border-primary-300 focus:ring focus:ring-primary-200 focus:ring-opacity-50"
            required></textarea>
          <div id="messageError" class="error"></div>
        </div>

        <div class="text-center">
          <button type="submit" class="btn mt-6 w-auto p-1 px-4 text-lg">
            Submit
          </button>
        </div>
      </form>
    </div>

    <AsideLayout slot="aside">
      <SearchWidget />
    </AsideLayout>
  </ContentLayout>
</MainLayout>

<script>
  // 獲取表單元素
  const form = document.getElementById('form') as HTMLFormElement;
  const nameError = document.getElementById('nameError') as HTMLDivElement;
  const emailError = document.getElementById('emailError') as HTMLDivElement;
  const messageError = document.getElementById(
    'messageError'
  ) as HTMLDivElement;

  form.addEventListener('submit', async (event) => {
    event.preventDefault();

    // 獲取表單數據
    const formData = new FormData(form);

    const params = new URLSearchParams();

    formData.forEach((value, key) => {
      params.append(key, value.toString());
    });

    params.append(
      'time',
      new Date().toLocaleString('en', { hour12: false }).toString()
    );

    const scriptID =
      'AKfycbyy2l9PM3VTazFI0uEI4RfGWbH_vNclGlepAthmF-p88c7fzVh2hoAEpv2NUqJk0pzD';
    const apiUrl = `https://script.google.com/macros/s/${scriptID}/exec?${params.toString()}`;

    console.log('formData', params, params.toString());

    try {
      const response = await fetch(apiUrl);

      if (response.ok) {
        const data = await response.json();
        console.log('成功提交表單：', data);

        form.reset();
      } else {
        console.error('提交表單失敗');
      }
    } catch (error) {
      console.error('發送請求時出現錯誤：', error);
    }
  });
</script>
